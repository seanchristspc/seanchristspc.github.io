<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.1.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon32_32.ico"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon_16_16.ico"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"seanchristspc.github.io",root:"/",scheme:"Muse",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"hide",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!0,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!0,lazyload:!0,pangu:!1,comments:{style:"tabs",active:"valine",storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="本文主要记录锁相环的学习笔记。 先从最简单的基础的锁相环概念讲起，然后通过理解基于乘法鉴相器的锁相环为突破口，加深对锁相环概念的理解。随后分别介绍三相锁相环的原理和单相锁相环的原理。笔记全篇比较长，可以挑选感兴趣的来看。最好先理解基于乘法鉴相器的锁相环原理，然后理解经典的三相锁相环原理，随后理解一个单相锁相环原理，然后就可随意挑选小节阅读。本篇文章并没有包含所有锁相环的内容，只是选取了电力电子领域"><meta property="og:type" content="article"><meta property="og:title" content="Phase Locked Loop Learning Notes"><meta property="og:url" content="https://seanchristspc.github.io/2022/03/30/PLL-Learning-Notes/index.html"><meta property="og:site_name" content="seanchrist"><meta property="og:description" content="本文主要记录锁相环的学习笔记。 先从最简单的基础的锁相环概念讲起，然后通过理解基于乘法鉴相器的锁相环为突破口，加深对锁相环概念的理解。随后分别介绍三相锁相环的原理和单相锁相环的原理。笔记全篇比较长，可以挑选感兴趣的来看。最好先理解基于乘法鉴相器的锁相环原理，然后理解经典的三相锁相环原理，随后理解一个单相锁相环原理，然后就可随意挑选小节阅读。本篇文章并没有包含所有锁相环的内容，只是选取了电力电子领域"><meta property="og:locale"><meta property="og:image" content="https://seanchristspc.github.io/2022/03/30/PLL-Learning-Notes/BasicPllConfiguration.png"><meta property="og:image" content="https://seanchristspc.github.io/2022/03/30/PLL-Learning-Notes/Multiplier.png"><meta property="og:image" content="https://seanchristspc.github.io/2022/03/30/PLL-Learning-Notes/MultiplierPDModel.png"><meta property="og:image" content="https://seanchristspc.github.io/2022/03/30/PLL-Learning-Notes/VCOCharacteristcCurve.png"><meta property="og:image" content="https://seanchristspc.github.io/2022/03/30/PLL-Learning-Notes/VCOModel.png"><meta property="og:image" content="https://seanchristspc.github.io/2022/03/30/PLL-Learning-Notes/LP.png"><meta property="og:image" content="https://seanchristspc.github.io/2022/03/30/PLL-Learning-Notes/PLLConfiguration.png"><meta property="og:image" content="https://seanchristspc.github.io/2022/03/30/PLL-Learning-Notes/SSRFSPLLVector.png"><meta property="og:image" content="https://seanchristspc.github.io/2022/03/30/PLL-Learning-Notes/SSRFSPLLConfiguration.png"><meta property="og:image" content="https://seanchristspc.github.io/2022/03/30/PLL-Learning-Notes/SSRFSPLLConfigurationSimple.png"><meta property="og:image" content="https://seanchristspc.github.io/2022/03/30/PLL-Learning-Notes/DSRF.png"><meta property="og:image" content="https://seanchristspc.github.io/2022/03/30/PLL-Learning-Notes/DQMNDecouple.png"><meta property="og:image" content="https://seanchristspc.github.io/2022/03/30/PLL-Learning-Notes/DDSRFSPLL.png"><meta property="og:image" content="https://seanchristspc.github.io/2022/03/30/PLL-Learning-Notes/SinglePhasePLLConfigurationVirtualReactivePower.png"><meta property="og:image" content="https://seanchristspc.github.io/2022/03/30/PLL-Learning-Notes/SinglePhaseEPLLConfiguration.png"><meta property="og:image" content="https://seanchristspc.github.io/2022/03/30/PLL-Learning-Notes/EPLL2.png"><meta property="og:image" content="https://seanchristspc.github.io/2022/03/30/PLL-Learning-Notes/SinglePhasePLLDelay90Degree.png"><meta property="og:image" content="https://seanchristspc.github.io/2022/03/30/PLL-Learning-Notes/SinglePhasePLLInversePark.png"><meta property="og:image" content="https://seanchristspc.github.io/2022/03/30/PLL-Learning-Notes/SOGI-QSG.png"><meta property="og:image" content="https://seanchristspc.github.io/2022/03/30/PLL-Learning-Notes/SOGIBode.png"><meta property="og:image" content="https://seanchristspc.github.io/2022/03/30/PLL-Learning-Notes/SOGI_PLLResult.png"><meta property="article:published_time" content="2022-03-30T10:33:55.000Z"><meta property="article:modified_time" content="2022-03-31T13:53:00.000Z"><meta property="article:author" content="seanchrist"><meta property="article:tag" content="PLL"><meta property="article:tag" content="Power Electronics"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://seanchristspc.github.io/2022/03/30/PLL-Learning-Notes/BasicPllConfiguration.png"><link rel="canonical" href="https://seanchristspc.github.io/2022/03/30/PLL-Learning-Notes/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-Hans"}</script><title>Phase Locked Loop Learning Notes | seanchrist</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="seanchrist" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">seanchrist</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">We sat and drank with the sun on our shoulder's and felt like free men.</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><a role="button" class="book-mark-link book-mark-link-fixed"></a> <a href="https://github.com/seanchristspc" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans"><link itemprop="mainEntityOfPage" href="https://seanchristspc.github.io/2022/03/30/PLL-Learning-Notes/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="seanchrist"><meta itemprop="description" content="阳光洒肩头 仿佛自由人"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="seanchrist"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Phase Locked Loop Learning Notes</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2022-03-30 10:33:55" itemprop="dateCreated datePublished" datetime="2022-03-30T10:33:55Z">2022-03-30</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">Edited on</span> <time title="Modified: 2022-03-31 13:53:00" itemprop="dateModified" datetime="2022-03-31T13:53:00Z">2022-03-31</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Power-Electronics/" itemprop="url" rel="index"><span itemprop="name">Power Electronics</span></a></span></span><br><span class="post-meta-item" title="Symbols count in article"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">Symbols count in article: </span><span>25k</span> </span><span class="post-meta-item" title="Reading time"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">Reading time &asymp;</span> <span>23 mins.</span></span><div class="post-description">本文主要记录锁相环的学习笔记。 先从最简单的基础的锁相环概念讲起，然后通过理解基于乘法鉴相器的锁相环为突破口，加深对锁相环概念的理解。随后分别介绍三相锁相环的原理和单相锁相环的原理。笔记全篇比较长，可以挑选感兴趣的来看。最好先理解基于乘法鉴相器的锁相环原理，然后理解经典的三相锁相环原理，随后理解一个单相锁相环原理，然后就可随意挑选小节阅读。本篇文章并没有包含所有锁相环的内容，只是选取了电力电子领域中的一些经典锁相环介绍。在理解这些经典的锁相环内容后，相信有能力可以追逐锁相环的前沿文献啦！</div></div></header><div class="post-body" itemprop="articleBody"><h1 id="接触锁相环的缘由"><a href="#接触锁相环的缘由" class="headerlink" title="接触锁相环的缘由"></a>接触锁相环的缘由</h1><p>学电力电子，尤其是新能源光伏或风电的并网运行需要同步电网，需要锁相环来同步相位信息。对于电力驱动领域，无位置传感器电力驱动有运用锁相环的需求。我最近研究的电力驱动内容也有需求锁定一个未知信号的相位，因此需要了解并使用锁相环。大概花了一个月的时间来学习锁相环，对锁相环的基本原理有了一定的了解。尤其是自己明白原理后，看其他文献就容易理解了。不会像最开始学习锁相环阶段，看着锁相环就头大，头晕。实际锁相环的基本原理并不难，尤其是公式推导过程（公式偏多），不要抵触，多花点时间就可以掌握。接下来首先介绍锁相环的需要完成的目标。</p><hr><h1 id="Phase-Locked-Loop-的目标"><a href="#Phase-Locked-Loop-的目标" class="headerlink" title="Phase Locked Loop 的目标"></a>Phase Locked Loop 的目标</h1><p>PLL 全称为 Phase Locked Loop，中文名把它叫做<strong>锁相环</strong>。PLL 的基本功能是<strong>跟踪</strong>、<strong>锁定</strong>交流信号的<strong>相位</strong>，且在必要时还可以提供有关信号的<strong>频率</strong>和<strong>幅值</strong><sup><a href="#fn_1" id="reffn_1">1</a></sup>。</p><hr><h1 id="乘法鉴相锁相环"><a href="#乘法鉴相锁相环" class="headerlink" title="乘法鉴相锁相环"></a>乘法鉴相锁相环</h1><p>基于乘法鉴相器的锁相环是最基础的一种。主要参看文献<strong>《PWM 整流器及其控制》</strong>来学习锁相环，以此来掌握核心的概念，并加深对锁相环的理解。</p><h2 id="锁相环的基本构成"><a href="#锁相环的基本构成" class="headerlink" title="锁相环的基本构成"></a>锁相环的基本构成</h2><p>基本锁相环的闭环控制回路一般含有<strong>鉴相器</strong>（PD）、<strong>环路滤波器</strong>（LF）和<strong>压控振荡器</strong>（VCO）这三种结构，如图1所示。乘法鉴相锁相环是指鉴相器采用<strong>乘法器</strong>的锁相环。</p><p><img data-src="/2022/03/30/PLL-Learning-Notes/BasicPllConfiguration.png" alt title="图1 基本闭环锁相环控制结构"></p><hr><ol><li>鉴相器：比较输入信号$v<em>{i}(t)$和输出信号$v</em>{o}(t)$的相位。</li><li>环路滤波器：滤除误差信号$v_{d}(t)$的二次谐波分量和噪声。</li><li>压控振荡器：完成电压和频率的变换，即压控振荡器的输出信号的频率与误差信号$v_{d}(t)$的大小成正比。</li></ol><hr><p>接下来就分别分析锁相环的三个基本单元<strong>鉴相器、环路滤波器、压控振荡器</strong>(PD,LP,VCO)的功能和数学模型。其中，锁相环最核心的部分是<strong>鉴相器</strong>。</p><hr><h2 id="乘法鉴相器-PD"><a href="#乘法鉴相器-PD" class="headerlink" title="乘法鉴相器 PD"></a>乘法鉴相器 PD</h2><p>实际要分析的是为什么<strong>乘法器</strong>能实现相位的比较? 带着这个问题去理解<strong>乘法鉴相器</strong>。</p><p>定义输入信号：</p><script type="math/tex;mode=display">\begin{equation}
    v_{i}(t) = V_i \sin[\omega_i t +\theta_i(t)]
\end{equation}</script><p>定义输出信号：</p><script type="math/tex;mode=display">\begin{equation}
    v_{o}(t) = V_o \cos[\omega_o t +\theta_o(t)]
\end{equation}</script><p>这样一看这两个信号就含有 $\omega<em>i$、$\omega_o$、$\theta</em>{i}(t)$、<br>$\theta_o(t)$、$V_i$ 和 $V_o$，总共6个变量，看来需要简化简化，方便后续的分析。</p><p>注意：<strong>输入输出信号为两正交信号</strong>（$\sin, \cos$）</p><p>以 $\omega_o$ 为参考频率，重新定义输入信号的瞬时相位：</p><script type="math/tex;mode=display">\begin{equation}
    [\omega_i t + \theta_i(t)] = \omega_o  t + 
    [(\omega_i-\omega_o)t + \theta_i(t)]
    = \omega_o t + \theta_{1}(t)
\end{equation}</script><p>其中，$\theta_{1}(t) =(\omega_i-\omega_o)t + \theta_i(t)=\Delta \omega_o t + \theta_i(t)$</p><p>输出信号的瞬时相位：</p><script type="math/tex;mode=display">\begin{equation}
    \omega_o t + \theta_o(t) = \omega_o t + \theta_2(t)
\end{equation}</script><p>其中，$\theta_2(t)=\theta_o(t)$。</p><p>简化后的输入输出信号表达式：</p><script type="math/tex;mode=display">\begin{equation}
    \left\{
        \begin{aligned}
            \label{eq:input and out signal}
            v_i(t) &= V_i \sin [\omega_o t + \theta_{1}(t)]\\
            v_o(t) &= V_o \cos [\omega_o t + \theta_{2}(t)]\\
        \end{aligned}
    \right.
\end{equation}</script><p>和最初定义相比，减少了一个频率变量$\omega_i$。</p><p>乘法鉴相器结构框图，如图2所示，简单的数学表达式为$v_d(t)=K_m v_i(t) v_o(t)$，其中$K_m$ 为乘法器的比列系数。</p><p><img data-src="/2022/03/30/PLL-Learning-Notes/Multiplier.png" alt title="图2 乘法鉴相器结构"></p><p>再用个积化和差公式：</p><script type="math/tex;mode=display">\begin{equation}
    \sin\alpha \cdot \cos\beta = \frac{1}{2}
    [\sin(\alpha+\beta)+\sin(\alpha-\beta) ]\\
\end{equation}</script><p>在乘法鉴相器数学表达式中，应用三角函数积化和差公式化简过程：</p><script type="math/tex;mode=display">\begin{equation}
    \label{eq:complex output signal}
    \begin{aligned}
        v_d(t) & = K_m v_i(t) v_o(t)\\
               & = K_m V_i V_o \cos [\omega_o t + \theta_{2}(t)] 
               \sin [\omega_o t + \theta_{1}(t)]\\
               & = \frac{1}{2} K_m V_i V_o \sin[2\omega_o t+
               \theta_1(t)+\theta_2(t)]+\frac{1}{2} K_m V_i V_o
               \sin[\theta_1(t)-\theta_2(t)]
    \end{aligned}
\end{equation}</script><p>其中，$\frac{1}{2} K_m V_i V_o \sin[2\omega_o t+\theta_1(t)+\theta_2(t)]$<br>含有二次谐波，需要设置一个低通滤波器将其滤除。</p><p>故公式$\eqref{eq:complex output signal}$可做进一步的简化，去掉二次谐波部分。</p><script type="math/tex;mode=display">\begin{equation}
    \label{eq:simple output singal}
    v_d(t)=\frac{1}{2} K_m V_i V_o\sin[\theta_1(t)-\theta_2(t)]
\end{equation}</script><p>看公式$\eqref{eq:simple output singal}$ 中的 $\theta_1(t)-\theta_2(t)$，这不是出现了两瞬时相位之差了吗？可以解决本小节最开始提出的问题。</p><p><strong><em>“实际要分析的是为什么乘法器能实现相位的比较?”</em></strong></p><p>进一步简化$v_d(t)$</p><p>定义瞬时相位差：</p><script type="math/tex;mode=display">\begin{equation}
    \begin{aligned}
    \theta_e(t) &= \theta_1(t)-\theta_2(t)\\
            &= \Delta \omega_o t + \theta_i(t) -\theta_o(t)    
    \end{aligned}
\end{equation}</script><p>定义幅值：</p><script type="math/tex;mode=display">\begin{equation}
    V_d = \frac{1}{2} K_m V_i V_o
\end{equation}</script><p>再进一步简化</p><script type="math/tex;mode=display">\begin{equation}
    v_d(t) = V_d \sin \theta_e(t)
\end{equation}</script><p>这已经是最简化的形式了。</p><p>定义过零点的斜率为$K_d$，把 $K_d$称为鉴相器的灵敏度。</p><script type="math/tex;mode=display">\begin{equation}
    K_d = \frac{\mathrm{d}v_d}{\mathrm{d}\theta_e}\bigg|_{\theta_e=0}
    =\frac{\mathrm{d}}{\mathrm{d}\theta_e}(V_d\sin\theta_e)\bigg|_{\theta_e=0}  
    = Vd
\end{equation}</script><p>故$v_d(t)$也可以写成：</p><script type="math/tex;mode=display">\begin{equation}
    v_d(t) = K_d \sin \theta_e(t)
\end{equation}</script><p>这就是乘法鉴相器的数学模型，其结构图请见图3。</p><p><img data-src="/2022/03/30/PLL-Learning-Notes/MultiplierPDModel.png" alt title="图3 乘法鉴相器模型结构"></p><h2 id="压控振荡器"><a href="#压控振荡器" class="headerlink" title="压控振荡器"></a>压控振荡器</h2><p><strong>何为压控振荡器？</strong></p><p>压控振荡器的振荡频率$\omega_v(t)$随控制电压$v_c(t)$成正比（近似正比）变化。如图4所示为压控振荡器特性曲线。</p><p><img data-src="/2022/03/30/PLL-Learning-Notes/VCOCharacteristcCurve.png" alt title="图4 压控振荡器特性曲线"></p><p>用数学表达式表示压控振荡器特性曲线：</p><script type="math/tex;mode=display">\begin{equation}
    \label{eq:VCOCharacteristic}
    \omega_v(t)=\omega_0 + K_o v_c(t)
\end{equation}</script><p>注意：<strong>$\omega_0$ 与 $\omega_o$ 区别，$\omega_0$一个是 VCO 固有振荡频率，<br>$\omega_o$ 是输出信号频率</strong>。</p><p>如图3所示，对鉴相器起作用的是瞬时相位$\theta_2(t)$,不是瞬时角频率 $\omega_v (t)$。</p><script type="math/tex;mode=display">\begin{equation}
     \omega_o t + \theta_2(t)=\int_{0}^{t} \omega_v(t) d(t)= \omega_0 t 
    + K_0 \int_{0}^{t} v_{c}(t) dt
\end{equation}</script><script type="math/tex;mode=display">\begin{equation}
    \theta_2(t) = K_0 \int_{0}^{t} v_{c}(t) dt
\end{equation}</script><p>这就是压控振荡器的数学模型，显然是一个积分器。定义微分算子 $p=d/dt$。</p><script type="math/tex;mode=display">\begin{equation}
    \theta_2(t) = K_0 \frac{v_{c}(t)}{p}
\end{equation}</script><p><img data-src="/2022/03/30/PLL-Learning-Notes/VCOModel.png" alt title="图5 压控振荡器数学模型"></p><h2 id="环路滤波器"><a href="#环路滤波器" class="headerlink" title="环路滤波器"></a>环路滤波器</h2><p>环路滤波器的作用主要是用来滤除鉴相器输出信号的<strong>二次谐波分量和噪声</strong>。</p><p>环路滤波器的$s$域数学模型:</p><script type="math/tex;mode=display">\begin{equation}
    V_c(s) = F(s) V_d(s)
\end{equation}</script><p>换成微分算子的形式：</p><script type="math/tex;mode=display">\begin{equation}
    v_c(t)=F(p)v_d(t)
\end{equation}</script><p><img data-src="/2022/03/30/PLL-Learning-Notes/LP.png" alt title="图6 环路滤波器时域模型结构图"></p><h2 id="乘法鉴相器锁相环基本相位方程"><a href="#乘法鉴相器锁相环基本相位方程" class="headerlink" title="乘法鉴相器锁相环基本相位方程"></a>乘法鉴相器锁相环基本相位方程</h2><p>根据前面三个基本单元的分析，可以综合成一个模型图，如图7所示。</p><p><img data-src="/2022/03/30/PLL-Learning-Notes/PLLConfiguration.png" alt title="图7 锁相环路的相位反馈系统结构"></p><script type="math/tex;mode=display">\begin{equation}
    \theta_e(t)=\theta_1(t) - \theta_2(t)=\theta_1(t) - K_0F(p) \frac{v_d(t)}{p}
    =\theta_1(t) - K_0 K_d F(p) \frac{1}{p} \sin \theta_e(t)
\end{equation}</script><p>两端微分：</p><script type="math/tex;mode=display">\begin{equation}
    \frac{\mathrm{d}\theta_e(t)}{\mathrm{d}t}+K_0 K_d F(p) \sin \theta_e(t)
    = \frac{\mathrm{d}\theta_1(t)}{\mathrm{d}t}
\end{equation}</script><h2 id="锁相环锁定问题"><a href="#锁相环锁定问题" class="headerlink" title="锁相环锁定问题"></a>锁相环锁定问题</h2><p>当锁相环输入一个频率和相位不随时间变化的信号，即$v_i(t)=V_i\sin(\omega_i t+\theta_i)$。$\omega_i$与$\theta_i$ 不随时间变化。</p><script type="math/tex;mode=display">\begin{equation}
    \frac{\mathrm{d}\theta_1(t)}{\mathrm{d}t}
    = \omega_i - \omega_o = \Delta \omega_o
\end{equation}</script><p>简化基本相位方程：</p><script type="math/tex;mode=display">\begin{equation}
    \underbrace{\frac{\mathrm{d}\theta_e(t)}{\mathrm{d}t}}_{\omega_e}
    +\underbrace{K_0 K_d F(p) \sin \theta_e(t)}_{\omega_v-\omega_0}
    = \Delta \omega_o
\end{equation}</script><p>参考锁相环的相位反馈图7和VCO特性方程$\eqref{eq:VCOCharacteristic}$，可得</p><script type="math/tex;mode=display">\begin{equation}
    \label{eq:control frequencyi difference}
    \begin{aligned}
        K_0 K_d F(p) \sin \theta_e(t) & = K_0 F(p)  [K_d\sin\theta_e(t)]\\
                          &= K_0 F(p) v_d(t)\\
                          &= K_0 v_c(t)\\
                          &= \omega_v - \omega_0
    \end{aligned}
\end{equation}</script><p>$\omega_v - \omega_0$称为控制频差，是压控振荡器受控制电压$v_c(t)$作用而产生的。</p><p>注意：<strong>$\omega_0$ 与 $\omega_o$ 区别，$\omega_0$一个是 VCO 固有振荡频率，$\omega_o$ 是输出信号频率</strong>。</p><p>$\frac{\mathrm{d}\theta_e(t)}{\mathrm{d}t}$ 可以用 $\omega_e$ 代替，被称为瞬时频差。</p><script type="math/tex;mode=display">\begin{equation}
    \begin{aligned}
    \frac{\mathrm{d}\theta_e(t)}{\mathrm{d}t} = 
    \frac{\mathrm{d}\theta_1(t)-\theta_2(t)}{\mathrm{d}t}
    \end{aligned}
\end{equation}</script><p>书上的解释不清楚，下面是我按照自己理解，来解释整个锁相环的工作情况。</p><p><strong>现在分析锁相环是如何实现频率的锁定和相位的锁定？</strong></p><p>根据图7来分析锁定问题。假设存在某一时刻$\theta_1(t)&gt;\theta_2(t)$，$0 &lt;\theta_e(t)&lt;\frac{\pi}{2}$，$\theta_1(t)$ 与 $\theta_2(t)$ 的差值在扩大，也就是说$\theta_1(t)$对应的角频率大于$\theta_2(t)$ 的角频率。$\theta_e(t)=\theta_1(t)-\theta_2(t)&gt;0$ $\uparrow$，那么 $v_d(t)$ $\uparrow$ ，那么 $v_c(t)$ $\uparrow$，那么对应 VCO 的输出信号频率增加$\omega_v$，那么$\theta_2(t)$的频率在增加，以此来追上$\theta_2(t)$的频率，当 $\theta_1(t)$的频率和 $\theta_2(t)$的频率相等时，$\theta_e(t)$就是一个恒定值，整个闭环系统进入稳态。</p><p><strong>现在的稳定状态是有输入输出信号是有相位差。为了实现相位偏差为零，可以在环路滤波器之后加一个PI，便可实现相位的零稳态误差。</strong></p><hr><h1 id="经典的三相锁相环"><a href="#经典的三相锁相环" class="headerlink" title="经典的三相锁相环"></a>经典的三相锁相环</h1><p>经典的三相系统的锁相环主要参考文献 <a target="_blank" rel="noopener" href="https://ieeexplore.ieee.org/document/567077">Operation of a phase locked loop system under distorted utility conditions</a><sup><a href="#fn_2" id="reffn_2">2</a></sup>。</p><h2 id="经典三相锁相环原理图"><a href="#经典三相锁相环原理图" class="headerlink" title="经典三相锁相环原理图"></a>经典三相锁相环原理图</h2><p><img data-src="/2022/03/30/PLL-Learning-Notes/SSRFSPLLVector.png" alt title="图8 SSRF-SPLL 矢量图"></p><p>SSRF-SPLL矢量图8各变量定义：</p><hr><ul><li>$\mathbf{V}$ 实际电压矢量</li><li>$\mathbf{V}_{pll}$ 锁相环的输出电压矢量</li><li>$\theta$ 实际电压矢量的矢量角度</li><li>$\hat{\theta}$ 锁相环输出的电压矢量角度</li></ul><hr><p><img data-src="/2022/03/30/PLL-Learning-Notes/SSRFSPLLConfiguration.png" alt title="图9 SSRF-SPLL 控制结构原理框图"></p><p>$\omega<em>{ff}$ 是检测电压的额定频率，那这个物理量的作用是什么？主要是设置一个检测信号的额定频率，实际信号的频率是在这个频率$\omega</em>{ff}$上下波动，主要降低PI控制器输出的压力，这样PI输出就没必要和额定频率一样大，只需一个较小的量$\Delta \omega<em>o$即可。同时，$\omega</em>{ff}$给系统的频率一个初始值，有维持系统稳定的作用（不必要从0直接突变到$\omega<em>{ff}$附近，而是直接在$\omega</em>{ff}$附近变化）。</p><p>上面的锁相环控制框图有点复杂，可以简化简化。</p><p>简化版的三相锁相环控制框图，如图10所示。</p><p><img data-src="/2022/03/30/PLL-Learning-Notes/SSRFSPLLConfigurationSimple.png" alt title="图10 简化版的三相锁相环控制框图"></p><h2 id="经典三相锁相环有关数学公式"><a href="#经典三相锁相环有关数学公式" class="headerlink" title="经典三相锁相环有关数学公式"></a>经典三相锁相环有关数学公式</h2><p>平衡的三相电网电压：</p><script type="math/tex;mode=display">\begin{equation}
    \label{eq:BalancedThreePhaseVoltage}
    \begin{aligned}
        v_a &=\mathbf{V} \cos(\omega_1 t)\\
        v_b &=\mathbf{V} \cos(\omega_1 t - 2\pi/3)\\
        v_a &=\mathbf{V} \cos(\omega_1 t - 4\pi/3)
    \end{aligned}
\end{equation}</script><script type="math/tex;mode=display">\begin{equation}
    \label{eq:AlphaBetaVoltage}
    \begin{aligned}
    \begin{bmatrix}
        v_{\alpha}\\
        v_{\beta}
    \end{bmatrix}
    =\frac{2}{3}
    \begin{bmatrix}
        1 & -\frac{1}{2} & -\frac{1}{2}\\
        0 & \frac{\sqrt{3}}{2} & -\frac{\sqrt{3}}{2}\\
    \end{bmatrix}
    \begin{bmatrix}
        v_a\\
        v_b\\
        v_c
    \end{bmatrix}
    =\mathbf{V}
    \begin{bmatrix}
        \cos (\omega_1 t)\\
        \sin (\omega_1 t)
    \end{bmatrix}
    =\mathbf{V}
    \begin{bmatrix}
        \cos \theta\\
        \sin \theta
    \end{bmatrix}
    \end{aligned}
\end{equation}</script><p>如果三相平衡电压以 $\sin$ 表示， $abc\rightarrow \alpha\beta$ 的变换方程：</p><script type="math/tex;mode=display">\begin{equation}
    \begin{aligned}
        \label{eq:AlphaBetaVoltage2}
    \begin{bmatrix}
        v_{\alpha}\\
        v_{\beta}
    \end{bmatrix}
    =\frac{2}{3}
    \begin{bmatrix}
        1 & -\frac{1}{2} & -\frac{1}{2}\\
        0 & \frac{\sqrt{3}}{2} & -\frac{\sqrt{3}}{2}\\
    \end{bmatrix}
    \begin{bmatrix}
        v_a\\
        v_b\\
        v_c
    \end{bmatrix}
    =\mathbf{V}
    \begin{bmatrix}
        \sin (\omega_1 t)\\
        -\cos (\omega_1 t)
    \end{bmatrix}
    =\mathbf{V}
    \begin{bmatrix}
        \sin \theta\\
        -\cos \theta
    \end{bmatrix}
    \end{aligned}
\end{equation}</script><script type="math/tex;mode=display">\begin{equation}
    \begin{bmatrix}
        v_d\\
        v_q
    \end{bmatrix}
    =
    \begin{bmatrix}
        \cos(\hat{\theta}) & \sin(\hat{\theta})\\
        -\sin(\hat{\theta}) & \cos(\hat{\theta})
    \end{bmatrix}
    \begin{bmatrix}
        v_\alpha\\
        v_\beta
    \end{bmatrix}
\end{equation}</script><p>$\hat{\theta}=\omega_o t+\varphi_o$</p><p>各物理量意义：</p><hr><ul><li>$\mathbf{V}$ 实际电压矢量</li><li>$\omega_1$ 电网电压角频率</li><li>$\theta$ 实际电压矢量的矢量角度</li><li>$\hat{\theta}$ 锁相环估计的电压矢量角度</li><li>$\omega_o$ 锁相环估计角频率</li></ul><hr><p>进一步简化计算：</p><script type="math/tex;mode=display">\begin{equation}
    \label{eq:SimpleAlphaBetaToDQ}
    \begin{bmatrix}
        v_d\\
        v_q
    \end{bmatrix}
    =\mathbf{V}
    \begin{bmatrix}
        \cos (\theta - \hat{\theta})\\
        \sin (\theta - \hat{\theta})
    \end{bmatrix}
    =\mathbf{V}
    \begin{bmatrix}
        \cos [(\omega_1 - \omega_o)t+\varphi_{error}]\\
        \sin [(\omega_1 - \omega_o)t+\varphi_{error}]
    \end{bmatrix}
\end{equation}</script><p>进行了一堆的数学推到过程，开始通过最后的数学表达式$\eqref{eq:SimpleAlphaBetaToDQ}$和图9开始分析三相锁相环原理。</p><h2 id="经典三相锁相环原理分析"><a href="#经典三相锁相环原理分析" class="headerlink" title="经典三相锁相环原理分析"></a>经典三相锁相环原理分析</h2><hr><p>输入信号和锁相环输出信号的可能性主要为<strong>频率</strong>和<strong>初相位</strong>的比较。频率不同$\omega<em>1 \neq \omega_o$， $v_q$ 是一个交流量。当频率锁定 $\omega_1 = \omega_o$， $v_q$ 是一个直流量。当频率和相位完全锁定， $\omega_1=\omega_o,\varphi</em>{error}=0$，$v_q=0$。 而图9原理框图，因PI环节，正好能实现 $v_q=0$ 要求。那么按照图9的原理便可实现锁相环的功能。</p><p><em>前面分析的三相锁相环的实现需要一个三相电网电压平衡的条件，对于不平衡的电网，无法适用。</em></p><h2 id="不平衡电网电压对锁相环的影响"><a href="#不平衡电网电压对锁相环的影响" class="headerlink" title="不平衡电网电压对锁相环的影响"></a>不平衡电网电压对锁相环的影响</h2><p><em>不平衡的电网电压可以用对称分量法分解成正序、负序和零序电压。</em></p><p><strong>不平衡电网电压用正、负和零序电压表达式：</strong>：</p><script type="math/tex;mode=display">\begin{equation}
    \label{eq:UnbalanceThreePhaseVoltage}
    \begin{aligned}
        v_a &=\mathbf{V}^+ \cos(\omega_1 t) +
        \mathbf{V}^- \cos(-\omega_1 t+\varphi^-) +
        \mathbf{V}^0 \cos(\omega_1 t + \varphi^0)\\
        v_b &=\mathbf{V}^+ \cos(\omega_1 t - 2\pi/3) +
        \mathbf{V}^- \cos(-\omega_1 t - 2\pi/3+\varphi^-) +
        \mathbf{V}^0 \cos(\omega_1 t - 2\pi/3+\varphi^0)\\
        v_a &=\mathbf{V}^+ \cos(\omega_1 t - 4\pi/3)+
        \mathbf{V}^- \cos(-\omega_1 t - 4\pi/3+\varphi^-)+
        \mathbf{V}^0 \cos(\omega_1 t - 4\pi/3+\varphi^0)
    \end{aligned}
\end{equation}</script><p>$0,+,-$ 分别代表零序，正序，负序。</p><script type="math/tex;mode=display">\begin{equation}
    \label{eq:PositiveAndNegativeComponentAlphaBeta}
    \mathbf{v}_{\alpha\beta}=
    \begin{bmatrix}
        v_{\alpha}\\
        v_{\beta}
    \end{bmatrix}
    = \mathbf{V}^+ + \mathbf{V}^-
    =\mathbf{V}^+
    \begin{bmatrix}
        \cos (\omega_1 t)\\
        \sin (\omega_1 t)
    \end{bmatrix}
    +\mathbf{V}^-
    \begin{bmatrix}
        \cos (-\omega_1 t + \varphi^-)\\
        \sin (-\omega_1 t + \varphi^-)
    \end{bmatrix}
\end{equation}</script><p>通过公式$~\eqref{eq:PositiveAndNegativeComponentAlphaBeta}$，可以得<br>到电网电压矢量的幅值和相位。</p><script type="math/tex;mode=display">\begin{equation}
    \label{eq:AmplitudeAndPhaseForUnbalance}
    \begin{aligned}
    |\mathbf{V}|=\sqrt{(\mathbf{V}^+)^2 + (\mathbf{V}^-)^2 + 2 \mathbf{V}^+ 
    \mathbf{V}^- \cos(-2\omega t + \varphi^-)}\\
    \theta = \omega t + \arctan(\frac{\mathbf{V}^- \sin 
    (-2 \omega t + \varphi^-)}
    {\mathbf{V}^+ + \mathbf{V}^- \cos (-2\omega t + \varphi^{-1})})
    \end{aligned}
\end{equation}</script><p>由公式$\eqref{eq:AmplitudeAndPhaseForUnbalance}$可以知道，不平衡的电网电压会出现波动的幅值和相角（角频率）。而波动的幅值和相角对经典的三相锁相环有不利的影响。经典的三相锁相环适应理想的平衡三相电网电压，但对其他非理想情况需要额外的处理措施，来弥补其对非理想电网电压适应不足问题。</p><p><strong>对应公式$\eqref{eq:AmplitudeAndPhaseForUnbalance}$，可以提出使用低通滤波器滤波方案，来抑制不平衡电压中的谐波分量。但是引入滤波器会降低响应速度。</strong> 经典的三相锁相环适应理想的平衡三相电网电压，但对其他非理想情况需要额外的处理措施，来弥补其对非理想电网电压适应不足问题。</p><p><strong><em>Se Kyo Chung 的三相锁相环闭环传递函数推导以及相角不平衡，谐波和直流偏置对三相锁相环误差理论分析写的不错<sup><a href="#fn_3" id="reffn_3">3</a></sup>，值得一提的是该文献的实验结果图简单明了，值得一读。</em></strong></p><p>为了用于不平衡的三相电网，也可以采取提取不平衡电网中正序电压电压。那么需要了解<strong>对称分量法</strong>的原理，以此来提取正序电压。</p><hr><h1 id="对称分量法"><a href="#对称分量法" class="headerlink" title="对称分量法"></a>对称分量法</h1><p>$ABC\longrightarrow NP0$ 对于三相非平衡ABC（可以是电压，也可以是电流，甚至其他信号）可以分解成 $N$(negative sequence)，$P$(positive sequence)，$0$(zero sequence)，这个方式被称为<strong>对称分量法</strong>。</p><script type="math/tex;mode=display">\begin{equation}
    \begin{bmatrix}
        P\\
        N\\
        0
    \end{bmatrix}
    =
    \frac{1}{3}
    \begin{bmatrix}
        1 & \alpha & \alpha^2\\
        1 & \alpha^2 & \alpha\\
        1 & 1 & 1\\
    \end{bmatrix}
    \begin{bmatrix}
        A\\
        B\\
        C\\
    \end{bmatrix}
\end{equation}</script><script type="math/tex;mode=display">\alpha = e^{j\frac{2\pi}{3}}</script><p>$NP0 \longrightarrow ABC$</p><p>至于理论推到，用 $NP0 \longrightarrow ABC$ 更易于理解。</p><script type="math/tex;mode=display">\begin{equation}
    \begin{bmatrix}
        A\\
        B\\
        C\\
    \end{bmatrix}
    =
    \begin{bmatrix}
        1 & 1 & 1\\
        \alpha^2 & \alpha & 1\\
        \alpha & \alpha^2 & 1\\
    \end{bmatrix}
    \begin{bmatrix}
        P\\
        N\\
        0
    \end{bmatrix}
\end{equation}</script><p><strong>提取的正序分量直接用于平衡三相锁相环的原理</strong>,便可解决三相锁相不平衡问题。但是该方法对变换频率的三相电网适应性差。提取正序分量用于锁相环的方法可参考文献<sup><a href="#fn_4" id="reffn_4">4</a></sup>。</p><h1 id="双同步坐标系解耦锁相环"><a href="#双同步坐标系解耦锁相环" class="headerlink" title="双同步坐标系解耦锁相环"></a>双同步坐标系解耦锁相环</h1><p>针对三相电网不平衡的锁相问题，Rodriguez 等人提出了双同步坐标系解耦锁相环<sup><a href="#fn_5" id="reffn_5">5</a></sup>，具有较高的响应速度、较高的鲁棒性和较精确的性能这一节的内容主要是理解<strong>双同步坐标系解耦锁相环原理</strong>。这一小节稍微有点复杂，不想看可以跳过，感兴趣或者闲来没事倒是可以看看。</p><p><strong>双同步坐标系</strong>故名思意该锁相环方法含有两个同步坐标系。</p><p><strong>因此定义两个同步坐标系</strong>：</p><hr><ul><li>$dq^{+}$坐标系，angular frequency: $\hat{\omega}$，angluar position: $\hat{\theta}$</li><li>$dq^{-}$坐标系，angular frequency: $-\hat{\omega}$，angluar position: $-\hat{\theta}$</li></ul><hr><p><strong>备注</strong>： 对于不平衡的三相电网电压系统，合成的电压矢量 $\mathbf{V}$ 虽然频率是固定的，但是幅值是不断变化的。而当把三相不平衡电压使用对称分量法，可以分解成<strong>正序</strong>、<strong>负序</strong>和<strong>零序</strong>。因为中性点连接的系统，不存在零序分量。故只剩下<strong>正序和负序</strong>。同时单个负序或正序的电压矢量的幅值是恒定的。正、负序分别对应$dq^+$、$dq^-$同步坐标系。用$dq^+$ 来锁相正序， $dq^-$ 来锁相负序是没有问题。</p><p>定义的双坐标系和电压矢量如图11所示。</p><p><img data-src="/2022/03/30/PLL-Learning-Notes/DSRF.png" alt title="图11 双同步坐标系及坐标系的电压矢量"></p><hr><h2 id="双同步坐标系的一些数学公式"><a href="#双同步坐标系的一些数学公式" class="headerlink" title="双同步坐标系的一些数学公式"></a>双同步坐标系的一些数学公式</h2><p>conventional $ \alpha \beta \longrightarrow dq$ transformation matrix</p><script type="math/tex;mode=display">\begin{equation}
    \label{eq:AlphaBetaToDQ}
    \mathbf{T}_{dq}=
    \begin{bmatrix}
        \cos(\theta) & \sin(\theta)\\
        -\sin(\theta) & \cos(\theta)
    \end{bmatrix}
\end{equation}</script><p>从图11可以发现，$dq^+$ 坐标系和我们传统的$dq$坐标系是一样的。故</p><script type="math/tex;mode=display">\begin{equation}
    \label{eq:AlphaBetaToDQPositive}
    \mathbf{T}_{dq^+}=
    \begin{bmatrix}
        \cos(\hat{\theta}) & \sin(\hat{\theta})\\
        -\sin(\hat{\theta}) & \cos(\hat{\theta})
    \end{bmatrix}
\end{equation}</script><p>而$dq^-$坐标系的位置角为 $-\hat{\theta}$, 故</p><script type="math/tex;mode=display">\begin{equation}
    \label{eq:AlphaBetaToDQNegative}
    [\mathbf{T}_{dq^-}]=
    \begin{bmatrix}
        \cos(-\hat{\theta}) & \sin(-\hat{\theta})\\
        -\sin(-\hat{\theta}) & \cos(-\hat{\theta})
    \end{bmatrix}
    =
    \begin{bmatrix}
        \cos(\hat{\theta}) & -\sin(\hat{\theta})\\
        \sin(\hat{\theta}) & \cos(\hat{\theta})
    \end{bmatrix}
    =[\mathbf{T}_{dq^+}]^T
\end{equation}</script><p>根据公式 $\eqref{eq:PositiveAndNegativeComponentAlphaBeta}$，再结合 $\mathbf{T}<em>{dq^+}$ 和 $\mathbf{T}</em>{dq^-}$，可以获得 $\mathbf{v}<em>{dq^+}$ 和 $\mathbf{v}</em>{dq^+}$:</p><script type="math/tex;mode=display">\begin{equation}
    \label{eq:DoubelSychrounousDQ}
    \begin{aligned}
        \mathbf{v}_{dq^+}=
        \begin{bmatrix}
            v_{d^+}\\
            v_{q^+}
        \end{bmatrix}
        =[\mathbf{T}_{dq^+}] \mathbf{v}_{\alpha\beta} 
        =\mathbf{V}^+
        \begin{bmatrix}
            \cos (\omega t -\hat{\theta})\\
            \sin (\omega t -\hat{\theta})
        \end{bmatrix}
        +\mathbf{V}^-
        \begin{bmatrix}
            \cos (-\omega t + \varphi^- - \hat{\theta})\\
            \sin (-\omega t + \varphi^- - \hat{\theta})
        \end{bmatrix}\\
        \mathbf{v}_{dq^-}=
        \begin{bmatrix}
            v_{d^-}\\
            v_{q^-}
        \end{bmatrix}
        =[\mathbf{T}_{dq^-}] \mathbf{v}_{\alpha\beta} 
        =\mathbf{V}^+
        \begin{bmatrix}
            \cos (\omega t +\hat{\theta})\\
            \sin (\omega t +\hat{\theta})
        \end{bmatrix}
        +\mathbf{V}^-
        \begin{bmatrix}
            \cos (-\omega t + \varphi^- + \hat{\theta})\\
            \sin (-\omega t + \varphi^- + \hat{\theta})
        \end{bmatrix}
    \end{aligned}
\end{equation}</script><p>前面我们已经知道，使用单同步坐标系的锁相环控制结构是可以实现 $\hat{\theta} \approx \omega t$，那么对于双同步坐标系，各自独立闭环运行，依旧可以实现 $\hat{\theta} \approx \omega t$。那么 $\hat{\theta} - \omega t$ 为一个很小的值，可以采用小信号分析方法。有如下的近似等式：</p><script type="math/tex;mode=display">\begin{equation}
    \label{eq:sincosapprox}
    \begin{aligned}
    \sin(\omega t - \hat{\theta}) & \approx \omega t 
    - \hat{\theta}\\
    \cos(\omega t - \hat{\theta}) & \approx 1 - ((\omega t - 
    \hat{\theta})^2/2)\\
    -\omega t - \hat{\theta} & \approx -2 \omega t
    \end{aligned}
\end{equation}</script><p>根据公式$\eqref{eq:sincosapprox}$，可以化简公式$\eqref{eq:DoubelSychrounousDQ}$,得到一个简化版结果。</p><script type="math/tex;mode=display">\begin{equation}
    \label{eq:SimpleDoubelSychrounousDQ}
    \begin{aligned}
        \mathbf{v}_{dq^+}
        &=\mathbf{V}^+
        \begin{bmatrix}
            1 - (\omega t -\hat{\theta})^2/2\\
            \omega t -\hat{\theta}
        \end{bmatrix}
        +\mathbf{V}^-
        \begin{bmatrix}
            \cos (-2\omega t + \varphi^-)\\
            \sin (-2\omega t + \varphi^-)
        \end{bmatrix}\\
        \mathbf{v}_{dq^-}
        &=\mathbf{V}^+
        \begin{bmatrix}
            \cos (2\omega t)\\
            \sin (2\omega t)
        \end{bmatrix}
        +\mathbf{V}^-
        \begin{bmatrix}
            \cos (\varphi^-)\\
            \sin (\varphi^-)
        \end{bmatrix}
    \end{aligned}
\end{equation}</script><p>至于得到简化的公式有何意义？$dq^+$ 和 $dq^-$ 坐标系的直流分量与电网电压的正序和负序分量的幅值有关，而2次谐波分量是分解两同步旋转坐标系而造成的耦合分量。接下来主要目标就是<strong>解耦耦合分量</strong>，或者说消除耦合分量。</p><hr><h2 id="解耦网络"><a href="#解耦网络" class="headerlink" title="解耦网络"></a>解耦网络</h2><p>为进行一般化分析，假设任意电压矢量包括正、负序分量两部分，分别以角速度 $n\omega$ 和 $m\omega$ 旋转，其中 $n$ 、$m$ 分别表示正、负序。电网角频率$\omega$。通过公式$\eqref{eq:PositiveAndNegativeComponentAlphaBeta}$，可以得电压矢量的正、负序分量表示为：</p><script type="math/tex;mode=display">\begin{equation}
    \label{eq:GeneralPositiveAndNegativeComponentAlphaBeta}
    \mathbf{v}_{\alpha\beta}=
    \begin{bmatrix}
        v_{\alpha}\\
        v_{\beta}
    \end{bmatrix}
    = \mathbf{V}_{\alpha\beta}^n + \mathbf{V}_{\alpha\beta}^m
    =\mathbf{V}^{n}
    \begin{bmatrix}
        \cos (n \omega t + \varphi^n)\\
        \sin (n \omega t + \varphi^n) 
    \end{bmatrix}
    +\mathbf{V}^{m}
    \begin{bmatrix}
        \cos (m \omega t + \varphi^m)\\
        \sin (m \omega t + \varphi^m)
    \end{bmatrix}
\end{equation}</script><p>$\varphi^n$ 和 $\varphi^m$ 正序和负序电压矢量的初始相位角。</p><p>现在正序、负序两个旋转坐标系分别用 $dq^n$ 和 $dq^m$ 来表示。$n \hat{\theta}$ 和$m \hat{\theta}$ 则表示正、负序的两个旋转坐标系的相位角度。$\hat{\theta}$ 为锁相环输出角度。</p><p><strong>先假设锁相环能完全锁相，即有 $\hat{\theta}=\omega t$。</strong>(至于为什么要这样假设？在理想的锁相的条件下，找出影响波动的原因,并把波动量消除，便可得到正确的锁相。同时，在常规的三相锁相环结构，就可以达到$\hat{\theta} \approx \omega t$的效果，因此做这样的假设是合理的操作)。那么，公式$\eqref{eq:GeneralPositiveAndNegativeComponentAlphaBeta}$ 在 $dq^n$ 和 $dq^m$ 坐标系下表达式为：</p><script type="math/tex;mode=display">\begin{equation}
    \label{eq:MNDoubelSychrounousDQ}
    \begin{aligned}
        \mathbf{v}_{dq^n} &=
        \begin{bmatrix}
            v_{d^n}\\
            v_{q^n}
        \end{bmatrix}
        =[\mathbf{T}_{dq^n}] \mathbf{v}_{\alpha\beta}=
        \begin{bmatrix}
            \cos(n\hat{\theta}) & \sin(n\hat{\theta})\\
            -\sin(n\hat{\theta}) & \cos(n\hat{\theta})
        \end{bmatrix}
        \begin{bmatrix}
            v_{\alpha}\\
            v_{\beta}
        \end{bmatrix}
        \\
                  &= \mathbf{V}^n
        \begin{bmatrix}
            \cos (\varphi^n)\\
            \sin (\varphi^n)
        \end{bmatrix}
        +\mathbf{V}^m\cos(\varphi^m)
        \begin{bmatrix}
            \cos ((n-m)\omega t)\\
            -\sin( (n-m)\omega t)
        \end{bmatrix}
        +\mathbf{V}^m\sin(\varphi^m)
        \begin{bmatrix}
            \sin ((n-m)\omega t)\\
            \cos ((n-m)\omega t)
        \end{bmatrix}\\
        \mathbf{v}_{dq^m} &=
        \begin{bmatrix}
            v_{d^m}\\
            v_{q^m}
        \end{bmatrix}
        =[\mathbf{T}_{dq^m}] \mathbf{v}_{\alpha\beta}=
        \begin{bmatrix}
            \cos(m\hat{\theta}) & \sin(m\hat{\theta})\\
            -\sin(m\hat{\theta}) & \cos(m\hat{\theta})
        \end{bmatrix}
        \begin{bmatrix}
            v_{\alpha}\\
            v_{\beta}
        \end{bmatrix}
        \\
                  &=\mathbf{V}^m
        \begin{bmatrix}
            \cos \varphi^m\\
            \sin \varphi^m
        \end{bmatrix}
        +\mathbf{V}^n\cos(\varphi^n)
        \begin{bmatrix}
            \cos ((n-m)\omega t)\\
            \sin ((n-m)\omega t)
        \end{bmatrix}
        +\mathbf{V}^n\sin(\varphi^n)
        \begin{bmatrix}
            -\sin ((n-m)\omega t)\\
            \cos ((n-m)\omega t)
        \end{bmatrix}\\
    \end{aligned}
\end{equation}</script><p>从公式$\eqref{eq:MNDoubelSychrounousDQ}$，我们得到了在<strong>锁相状态($\omega t = \hat{\theta}$)</strong>下的 $\mathbf{v}<em>{dq^n}$和$\mathbf{v}</em>{dq^n}$的表达式。通过表达式可以知道，$dq^n$坐标系下的交流量(振荡量)的幅值由 $dq^m$ 坐标系下的平均值所决定。与之对应的， $dq^m$ 坐标系下的<strong>交流量</strong>的幅值由$dq^n$坐标系下的平均值决定。<strong>解耦的目标就是消除振荡量(交流量)。</strong>既然实际的$\mathbf{v}<em>{dq^n}$ 和 $\mathbf{v}</em>{dq^m}$ 中含有交流量部分，为了消除交流量，可以\textbf{构造一个等量的交流量来与之做差}，便可消除交流部分。<br>以消除交流分量为目标，如图12所示，为$dq^n$ 坐标系下的解耦网络。</p><p><img data-src="/2022/03/30/PLL-Learning-Notes/DQMNDecouple.png" alt title="图12 $dq^n$坐标系的解耦网络"></p><p>针对$dq^m$坐标系，可以根据公式$\eqref{eq:MNDoubelSychrounousDQ}$，构造对应的解耦网络。</p><p>那么$dq^n$和$dq^m$双同步坐标系的解耦网络如图13所示。其中LPF是一个一阶低通滤波器，其传递函数可表示为：</p><script type="math/tex;mode=display">\begin{equation}
    LPF(s)=\frac{\omega_f}{s+\omega_f}
\end{equation}</script><p>文献[5]中，在这个解耦网络的基础上，进一步用状态空间方程来表示该解耦网络。个人认为，对于理解双坐标系的锁相环原理到此，就可以完全理解其核心理念了。文献[5]用状态空间模型的目的大概在于表达形式更统一，简便吧！</p><p>通过对解耦网络图13和传统的三相锁相环结构图10整合，可以得到双同步坐标系下锁相环整个原理框图，如图14所示。 <strong>$n$ 或 $m$ 分别代表正负序的意义。</strong></p><p><img data-src="/2022/03/30/PLL-Learning-Notes/DDSRFSPLL.png" alt title="图14 DDSRF-SPLL原理框图"></p><p>该方法解决了前面提取正序方案无法应对变换频率的问题。对频率具有良好的适应性。尽管该接偶环节加了一个一阶低通滤波器降低了响应速度，但是该锁相环的效果还是不错的。三相锁相环的研究就告一段落。接下来开始研究<strong>单相锁相环</strong>。</p><hr><h1 id="虚拟平均无功鉴相单相锁相环"><a href="#虚拟平均无功鉴相单相锁相环" class="headerlink" title="虚拟平均无功鉴相单相锁相环"></a>虚拟平均无功鉴相单相锁相环</h1><p><img data-src="/2022/03/30/PLL-Learning-Notes/SinglePhasePLLConfigurationVirtualReactivePower.png" alt title="图15 基于虚拟平均无功鉴相的单相锁相环控制结构"></p><p>该方法取了一个高大上的名字<strong>虚拟平均无功鉴相单相锁相环</strong>，实际从本质上来看就是最开始分析的<strong>乘法鉴相锁相环</strong>。如果再本质一点就是<strong>乘法器</strong>。</p><p>输入信号：</p><script type="math/tex;mode=display">\begin{equation}
    e_i=V\cos \theta
\end{equation}</script><p>锁相环输出相角：$\hat{\theta}$</p><p>定义一个虚拟的电流$i_s$（简单的说就是一个假想的物理量，在真实的物理世界不存在的物理量)重要的是它的数学表达式：</p><script type="math/tex;mode=display">\begin{equation}
    i_s=\sin \hat{\theta}
\end{equation}</script><p>上面$e_i$和 $i_s$ 经过乘法器得到的结果，定义为虚拟无功功率$p$:</p><script type="math/tex;mode=display">\begin{equation}
    p=V\cos\theta \sin \hat{\theta}
\end{equation}</script><p>三角函数积化和差公式用于 $p$:</p><script type="math/tex;mode=display">\begin{equation}
    p=\frac{V}{2}\sin (\hat{\theta} - \theta)
    +\frac{V}{2} \sin (\hat{\theta} + \theta)
\end{equation}</script><p>和乘法器鉴相锁相环相似的处理逻辑，低通滤波器滤除$\frac{V}{2} \sin (\hat{\theta} + \theta)$ 交流分量，得到无功功率平均值$\bar{p}$。</p><script type="math/tex;mode=display">\begin{equation}
    \bar{p}=\frac{V}{2}\sin (\hat{\theta} - \theta)
\end{equation}</script><p>假设该系统成功锁相，那么有 $\theta \approx \hat{\theta}$, 小信号处理，可以得到</p><script type="math/tex;mode=display">\begin{equation}
    \bar{p} = \frac{V}{2}(\hat{\theta} - \theta)
\end{equation}</script><p>那么只要控制$\bar{p}$为0，便可以实现锁相。这也是 $\bar{p}^{ * }=0$ 的原因。</p><p>虚拟平均无功鉴相单相锁相环的整个原理，控制结构图15充分展现其原理。</p><p>该方法简单，但该方法的动态性能比较弱(添加了低通滤波器LPF)。它对电网谐波不敏感，算一个优点吧。无法获得电网的幅值信息，算一个缺点吧。</p><hr><h1 id="增强型单相锁相环EPLL"><a href="#增强型单相锁相环EPLL" class="headerlink" title="增强型单相锁相环EPLL"></a>增强型单相锁相环EPLL</h1><p>为了解决<strong>虚拟平均无功鉴相单相锁相环</strong>动态响应速度慢的问题，采用基于自适应滤波理论的来重构输入信号的基波分量，同时可以实现对输入信号幅值、相位角与频率的估算。把这种基于自适应滤波理论的锁相环称为<strong>增强型单相锁相环</strong><sup><a href="#fn_6" id="reffn_6">6</a></sup>.</p><p><img data-src="/2022/03/30/PLL-Learning-Notes/SinglePhaseEPLLConfiguration.png" alt title="图16 增强型单相锁相环控制结构"></p><p>该控制结构多了一个比较陌生的变量$\hat{A}$，他是用来估算输入锁相信号的幅值。</p><p>根据图16的控制结构，可以写出$e_d$</p><script type="math/tex;mode=display">\begin{equation}
    \label{eq:SingleEpllPDSignal}
    \begin{aligned}
        e_d &= e \times \sin \hat{\theta}\\
            &= (e_i-\hat{e_i}) \sin \hat{\theta}\\
            &= (\hat{A} \cos \hat{\theta}-V\cos \theta) 
            \sin \hat{\theta}\\
            &= \frac{V}{2} \sin (\hat{\theta} -\theta)+
            \frac{V}{2} \sin (\theta + \hat{\theta}) -
            \frac{\hat{A}}{2} \sin 2 \hat{\theta}
    \end{aligned}
\end{equation}</script><p>仔细端详该控制结构框图，会发现在<strong>稳态</strong>时，有$\hat{A} \approx V$, $\hat{\theta} \approx \theta$，在使用小信号模型分析方法，可以简化公式$\eqref{eq:SingleEpllPDSignal}$，得到一个有关相位差的公式。</p><script type="math/tex;mode=display">\begin{equation}
    e_d = \frac{V}{2} (\hat{\theta}-\theta)
\end{equation}</script><p>值得注意的是控制框图中的PD环节中有一个积分系数 $K$, $K$的大小决定的是线电压幅值估算值 $\hat{A}$ 的收敛速度。<strong>$\hat{A}$的收敛目标就是线电压幅值</strong>。</p><p>该锁相环的近似闭环传递函数：</p><script type="math/tex;mode=display">\begin{equation}
    H(s)=K_v \frac{s K_p + K_i}{s^2+s K_v K_p + K_v K_i}
\end{equation}</script><p>$K_v$ 为鉴相器的稳态增益， $K_v=\frac{V}{2}$。但是该闭环传递函数如何得来的，目前还不是特别清楚？</p><p>该方案替换了低通滤波器，通过使$\frac{V}{2} \sin (\theta + \hat{\theta})$、$\frac{\hat{A}}{2} \sin 2 \hat{\theta}$ 两者抵消的方案实现交流量的滤除。尽管提高了锁相环的响应速度，具有较好的动态性能。但是该锁相环方案对谐波比较敏感。不适合含有大量谐波的场合，需要先进行谐波滤除，才能应用该方案。</p><p><img data-src="/2022/03/30/PLL-Learning-Notes/EPLL2.png" alt title="图17 增强型单相锁相环另一个控制结构"></p><p>图16的控制结构和图17只是$\sin$和$\cos$互换，依然能实现锁相环的功能。</p><hr><h1 id="基于延迟法的虚拟两相的单相锁相环"><a href="#基于延迟法的虚拟两相的单相锁相环" class="headerlink" title="基于延迟法的虚拟两相的单相锁相环"></a>基于延迟法的虚拟两相的单相锁相环</h1><p>前面针对单相锁相环的处理都是集中在单个输入信号。当然，可以采取前面的三相锁相环的思路，来构造一个虚拟的正交信号，来模仿三相锁相环的原理。输入信号定义为$v<em>{\beta}$，经过$90^{\circ}$的延时来虚拟一个$v</em>{\alpha}$。而通过公式$\eqref{eq:AlphaBetaVoltage}$可以知道，$v<em>{\alpha}$ 的相角和三相的$v_a$相角对应(这句话实际没啥意义，可以忽略！)。有了$v</em>{\alpha}$和 $v_{\beta}$，那么就可以使用三相锁相环的处理方案。</p><p>如图18所示，为基于延迟法的虚拟两相的单相锁相环的控制结构。和经典的三相锁相环结构对比对比就可以理解啦！延迟$90^{\circ}$的方法，影响响应速度。</p><p><img data-src="/2022/03/30/PLL-Learning-Notes/SinglePhasePLLDelay90Degree.png" alt title="图18 基于延迟法虚拟两相的单相锁相环控制结构"></p><hr><h1 id="基于微分法的虚拟两相的单相锁相环"><a href="#基于微分法的虚拟两相的单相锁相环" class="headerlink" title="基于微分法的虚拟两相的单相锁相环"></a>基于微分法的虚拟两相的单相锁相环</h1><p>知道$v<em>{\beta}$ 获得 $v</em>{\alpha}$ 的方式，除了使用延迟方式，还可以使用微分的方式。但是有个一个前提， <strong>输入信号$v_{\beta}$为理想的正弦信号</strong>。对于非理想电网就会出现问题。尽管速度提高了，但微分环节的引入，抗噪声能力严重下降。</p><p>如果想把非理想正弦的信号变换为正弦的理想信号，又需要加入滤波器，这又引入了延迟。哈哈！进入无限死循环。该微分法的原理框图不在列出，本质上和基于延迟法的单相锁相环没有差别。</p><hr><h1 id="基于Park反变换虚拟两相的单相锁相环"><a href="#基于Park反变换虚拟两相的单相锁相环" class="headerlink" title="基于Park反变换虚拟两相的单相锁相环"></a>基于Park反变换虚拟两相的单相锁相环</h1><p>基于Park反变换的方法有点意思，所以把控制结构图列出来，如图19所示。尽管文献<sup><a href="#fn_7" id="reffn_7">7</a></sup>有其他分析思路，但是我更倾向于更简单有效的理解方式。把这个反Park变换作为估计$v<em>{\beta}$的一种观测器来理解。同样和前面的基于虚拟两相的方法具有一曲同功之妙。已知输入信号$v</em>{\alpha}$，通过坐标变换获得$v_{\beta}$，然后使 $v_d=0$,即可实现锁相环功能。</p><p><img data-src="/2022/03/30/PLL-Learning-Notes/SinglePhasePLLInversePark.png" alt title="图19 基于Park反变换虚拟两相的单相锁相环"></p><p>列写几个变换方程（通过上面结构框图可以得到），意思意思一下。</p><script type="math/tex;mode=display">\begin{equation}
    \begin{bmatrix}
        v_d\\
        v_q
    \end{bmatrix}
    =
    \begin{bmatrix}
        \cos(\hat{\theta}) & \sin(\hat{\theta})\\
        -\sin(\hat{\theta}) & \cos(\hat{\theta})
    \end{bmatrix}
    \begin{bmatrix}
        v_{\alpha}\\
        v_{\beta}
    \end{bmatrix}
\end{equation}</script><script type="math/tex;mode=display">\begin{equation}
    \begin{bmatrix}
        v_{\alpha}'\\
        v_{\beta}'
    \end{bmatrix}
    =
    \begin{bmatrix}
        \cos(\hat{\theta}) & -\sin(\hat{\theta})\\
        \sin(\hat{\theta}) & \cos(\hat{\theta})
    \end{bmatrix}
    \begin{bmatrix}
        v_d'\\
        v_q'
    \end{bmatrix}
\end{equation}</script><script type="math/tex;mode=display">v_{\beta}=v_{\beta}'</script><script type="math/tex;mode=display">\begin{equation}
    v_{d}'(s)=\frac{v_d(s)}{\tau_d s + 1}
\end{equation}</script><script type="math/tex;mode=display">\begin{equation}
    v_{q}'(s)=\frac{v_q(s)}{\tau_d s + 1}
\end{equation}</script><hr><h1 id="基于SOGI的单相锁相环"><a href="#基于SOGI的单相锁相环" class="headerlink" title="基于SOGI的单相锁相环"></a>基于SOGI的单相锁相环</h1><p>SOGI全称为 <strong>Second-Order Generalized Integrator</strong>，翻译成中文为<strong>二阶广义积分器</strong>。基于SOGI的单相锁相环的核心就是<strong>SOGI</strong>，如果明白SOGI，剩下的问题就迎刃而解啦！</p><p>简单的说一下SOGI的功能：<strong>SOGI的两个输出信号严格的满足$90^{\circ}$的相位偏差(两输出信号严格的正交)，同时其中一个输出能精确的跟踪输入基频信号。</strong></p><p>如果能得到两个严格正交的信号，可以分别定义为$v<em>{\alpha}$、$v</em>{\beta}$，那么再利用前面经典的三相锁相环原理，便可实现锁相环功能。</p><p>如图20所示，为SOGI-QSG(Second-Order Generalized Integrator Quadrature Signals Generation)的原理框图。</p><p><img data-src="/2022/03/30/PLL-Learning-Notes/SOGI-QSG.png" alt title="图20 SOGI-QSG原理框图"></p><h2 id="为什么SOGI能精确跟踪为正弦的输入信号"><a href="#为什么SOGI能精确跟踪为正弦的输入信号" class="headerlink" title="为什么SOGI能精确跟踪为正弦的输入信号?"></a>为什么SOGI能精确跟踪为正弦的输入信号?</h2><p>根据图20，可以得到SOGI的开环传递函数：</p><script type="math/tex;mode=display">\begin{equation}
    \label{eq:SOGIOpenLoopTransferFunction}
    \begin{aligned}
    \frac{v_{\alpha}(s)}{K\varepsilon_v(s)}
    &=\frac{s \hat{\omega_o}}{s^2+\hat{\omega_o}^2}\\
    \frac{v_{\beta}(s)}{K\varepsilon_v(s)}
    &=\frac{\hat{\omega_o}^2}{s^2+\hat{\omega_o}^2}
    \end{aligned}
\end{equation}</script><p>正弦信号的 laplace 变换</p><script type="math/tex;mode=display">\begin{equation}
    \label{eq:SinusoidalLaplaceTransfer}
    \begin{aligned}
        \mathcal{L}\{\sin(\omega t)\}&=\frac{\omega}{s^2+\omega^2}\\
        \mathcal{L}\{\cos(\omega t)\}&=\frac{s}{s^2+\omega^2}
    \end{aligned}
\end{equation}</script><p>根据<strong>内膜原理</strong><sup><a href="#fn_8" id="reffn_8">8</a></sup>，可以用一句简单的话来说，<strong>整个控制系统要使输入信号与输出信号无静差，完全精准跟踪输入信号，那么只要满足控制系统的开环传递函数中含有输入信号的s域模型的条件，便可实现精准无静差跟踪。</strong></p><p>比较好的 <a target="_blank" rel="noopener" href="https://engineering.purdue.edu/~zak/ECE_382-Fall_2018/hand_3.pdf">The Internal Model Principle</a> 教程是 Purdue 大学 Zak 教授的这一篇内膜原理笔记。有兴趣，可以读一读。</p><p>观察公式 $\eqref{eq:SOGIOpenLoopTransferFunction}$和公式$\eqref{eq:SinusoidalLaplaceTransfer}$你会发现恰巧SOGI的开环传递函数含有正弦信号的s域模型。那么就解决了为什么SOGI可以精确跟踪正弦信号。</p><h2 id="为什么SOGI两输出信号严格正交？"><a href="#为什么SOGI两输出信号严格正交？" class="headerlink" title="为什么SOGI两输出信号严格正交？"></a>为什么SOGI两输出信号严格正交？</h2><p>SOGI的闭环传递函数：</p><script type="math/tex;mode=display">\begin{equation}
    \label{eq:SOGIClosedLoopTransferFunction}
    \begin{aligned}
     G_{\alpha} &=\frac{v_{\alpha}(s)}{v(s)}
     =\frac{ks}{s^2+ks+\hat{\omega_o}^2}\\
     G_{\beta} &=\frac{v_{\beta}(s)}{v(s)}
     =\frac{k\hat{\omega_o}}{s^2+ks+\hat{\omega_o}^2}
    \end{aligned}
\end{equation}</script><p>可以直接看两闭环传递函数$\eqref{eq:SOGIClosedLoopTransferFunction}$互差$90^{\circ}$。</p><script type="math/tex;mode=display">\begin{equation}
    \angle G_{\alpha} - \angle G_{\beta}=\frac{\pi}{2}
\end{equation}</script><p>因此SOGI的两输出信号严格正交。</p><p><img data-src="/2022/03/30/PLL-Learning-Notes/SOGIBode.png" alt title="图21 SOGI闭环传递函数bode图"></p><p>从闭环传递函数 Bode 图中也可以验证SOGI输出信号严格正交，<br>$G<em>{\alpha}$、 $G</em>{\beta}$ 相角严格互差$\frac{\pi}{2}$。</p><p>从图21可以发现，$G_{\alpha}$可以看作一个带通滤波器，在频率 $\hat{\omega_o}$ 处无衰减，但在其它频率就有衰减作用，越偏离 $\hat{\omega_o}$，衰减越厉害。这也是锁相环所期望的，锁定频率基本不衰减，其他次谐波都衰减，过滤。因此基于SOGI的单相锁相环性能不错，能抵抗谐波干扰。</p><p>写了这么多理论，放一个基于 SOGI 的 simulink 的仿真波形吧！如图22所示。</p><p><img data-src="/2022/03/30/PLL-Learning-Notes/SOGI_PLLResult.png" alt title="图22 SOGI PLL仿真波形"></p><p>对SOGI单相锁相环有兴趣，可以参考文献<sup><a href="#fn_9" id="reffn_9">9</a></sup>，该文献对SOGI单相锁相环写的清晰明了，图文并茂。</p><hr><h1 id="锁相环的性能指标"><a href="#锁相环的性能指标" class="headerlink" title="锁相环的性能指标"></a>锁相环的性能指标</h1><hr><ul><li>稳态相角误差 state phase-angle error</li><li>相角响应速度 speed of response to angle</li><li>频率响应速度 speed of response to frequency</li><li>变频的适应能力 variable frequency rejection</li><li>谐波适应能力 harmonic rejection</li><li>非平衡电网适应能力 line unbalance rejection</li></ul><hr><h1 id="推荐阅读有关PLL文献"><a href="#推荐阅读有关PLL文献" class="headerlink" title="推荐阅读有关PLL文献"></a>推荐阅读有关PLL文献</h1><p><a target="_blank" rel="noopener" href="https://ieeexplore.ieee.org/document/1318659">A method for synchronization of power electronic converters in polluted and variable-frequency environments</a></p><p><a target="_blank" rel="noopener" href="https://ieeexplore.ieee.org/document/1348790">Performance evaluation of PLL algorithms for single-phase grid-connected systems</a></p><p><a target="_blank" rel="noopener" href="https://ieeexplore.ieee.org/document/4118328">Decoupled Double Synchronous Reference Frame PLL for Power Converters Control</a></p><p><a target="_blank" rel="noopener" href="https://ieeexplore.ieee.org/document/4497881">Comparison of Three Single-Phase PLL Algorithms for UPS Applications</a></p><p><a target="_blank" rel="noopener" href="https://ieeexplore.ieee.org/document/955993">PLL structures for utility connected systems</a></p><p><a target="_blank" rel="noopener" href="https://ieeexplore.ieee.org/document/844502">A phase tracking system for three phase utility interface inverters</a></p><p><a target="_blank" rel="noopener" href="https://ieeexplore.ieee.org/document/567077">Operation of a phase locked loop system under distorted utility conditions</a></p><p><a target="_blank" rel="noopener" href="https://ieeexplore.ieee.org/document/1711988">A new single-phase PLL structure based on second order generalized integrator</a></p><p><a href="{https://ieeexplore.ieee.org/document/986202">A new phase-locked loop (PLL) system</a></p><hr><h1 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h1><p>I would greatly appreciate hearing about any error in this article, even minor ones. I welcome your suggestions for improvements, even tiny one. Please contact me by email 😜! Have fun!</p><hr><h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><blockquote id="fn_1"><sup>1</sup>. 张崇巍, 张兴. PWM 整流器及其控制 [M]. 北京: 机械工业出版社, 2012.<a href="#reffn_1" title="Jump back to footnote [1] in the text."> &#8617;</a></blockquote><blockquote id="fn_2"><sup>2</sup>. KAURA V, BLASKO V. Operation of a phase locked loop system under distorted utility conditions[J]. IEEE Transactions on Industry applications, 1997, 33(1): 58-63.<a href="#reffn_2" title="Jump back to footnote [2] in the text."> &#8617;</a></blockquote><blockquote id="fn_3"><sup>3</sup>. CHUNG S K. A phase tracking system for three phase utility interface inverters[J/OL]. IEEE Transactions on Power electronics, 2000, 15(3): 431-438. DOI: 10.1109/63.844502.<a href="#reffn_3" title="Jump back to footnote [3] in the text."> &#8617;</a></blockquote><blockquote id="fn_4"><sup>4</sup>. LEE S J, KANG J K, SUL S K. A new phase detecting method for power conversion systems considering distorted conditions in power system[C/OL]//Conference Record of the 1999 IEEE Industry Applications Conference. Thirty-Forth IAS Annual Meeting (Cat. No.99CH36370):volume 4. 1999: 2167-2172 vol.4. DOI: 10.1109/IAS.1999.798754.<a href="#reffn_4" title="Jump back to footnote [4] in the text."> &#8617;</a></blockquote><blockquote id="fn_5"><sup>5</sup>. RODRIGUEZ P, POU J, BERGAS J, et al. Decoupled double synchronous reference frame pll for power converters control[J/OL]. IEEE Transactions on Power Electronics, 2007, 22(2):584-592. DOI: 10.1109/TPEL.2006.890000.<a href="#reffn_5" title="Jump back to footnote [5] in the text."> &#8617;</a></blockquote><blockquote id="fn_6"><sup>6</sup>. KARIMI-GHARTEMANI M, IRAVANI M R. A method for synchronization of power electronic converters in polluted and variable-frequency environments[J]. IEEE Transactions on Power Systems, 2004, 19(3): 1263-1270.<a href="#reffn_6" title="Jump back to footnote [6] in the text."> &#8617;</a></blockquote><blockquote id="fn_7"><sup>7</sup>. SILVA S M, LOPES B M, CAMPANA R P, et al. Performance evaluation of pll algorithms for single-phase grid-connected systems[C]//Conference Record of the 2004 IEEE Industry Applications Conference, 2004. 39th IAS Annual Meeting.: volume 4. IEEE, 2004: 2259-2263.<a href="#reffn_7" title="Jump back to footnote [7] in the text."> &#8617;</a></blockquote><blockquote id="fn_8"><sup>8</sup>. FRANCIS B A, WONHAM W M. The internal model principle for linear multivariable regulators[J]. Applied mathematics and optimization, 1975, 2(2): 170-194.<a href="#reffn_8" title="Jump back to footnote [8] in the text."> &#8617;</a></blockquote><blockquote id="fn_9"><sup>9</sup>. CIOBOTARU M, TEODORESCU R, BLAABJERG F. A new single-phase pll structure based on second order generalized integrator[C/OL]//2006 37th IEEE Power Electronics Specialists Conference. 2006: 1-6. DOI: 10.1109/pesc.2006.1711988. <a href="#reffn_9" title="Jump back to footnote [9] in the text.">&#8617;</a></blockquote><hr></div><div class="reward-container"><div>Donate</div><button onclick='var qr=document.getElementById("qr");qr.style.display="none"===qr.style.display?"block":"none"'>Donate</button><div id="qr" style="display:none"><div style="display:inline-block"><img src="/images/wechatpay.png" alt="seanchrist WeChat Pay"><p>WeChat Pay</p></div><div style="display:inline-block"><img src="/images/alipay.jpg" alt="seanchrist Alipay"><p>Alipay</p></div></div></div><div class="followme"><p>Welcome to my other publishing channels</p><div class="social-list"><div class="social-item"><a target="_blank" class="social-link" href="/atom.xml"><span class="icon"><i class="fa fa-rss"></i> </span><span class="label">RSS</span></a></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/PLL/" rel="tag"><i class="fa fa-tags"></i>PLL</a> <a href="/tags/Power-Electronics/" rel="tag"><i class="fa fa-tags"></i>Power Electronics</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2022/03/29/Debug-MATLAB-Code/" rel="prev" title="A simple debug MATLAB code tutorial"><i class="fa fa-chevron-left"></i> A simple debug MATLAB code tutorial</a></div><div class="post-nav-item"></div></div></footer></article></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">Table of Contents</li><li class="sidebar-nav-overview">Overview</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8E%A5%E8%A7%A6%E9%94%81%E7%9B%B8%E7%8E%AF%E7%9A%84%E7%BC%98%E7%94%B1"><span class="nav-number">1.</span> <span class="nav-text">接触锁相环的缘由</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Phase-Locked-Loop-%E7%9A%84%E7%9B%AE%E6%A0%87"><span class="nav-number">2.</span> <span class="nav-text">Phase Locked Loop 的目标</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B9%98%E6%B3%95%E9%89%B4%E7%9B%B8%E9%94%81%E7%9B%B8%E7%8E%AF"><span class="nav-number">3.</span> <span class="nav-text">乘法鉴相锁相环</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%94%81%E7%9B%B8%E7%8E%AF%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%9E%84%E6%88%90"><span class="nav-number">3.1.</span> <span class="nav-text">锁相环的基本构成</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B9%98%E6%B3%95%E9%89%B4%E7%9B%B8%E5%99%A8-PD"><span class="nav-number">3.2.</span> <span class="nav-text">乘法鉴相器 PD</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8E%8B%E6%8E%A7%E6%8C%AF%E8%8D%A1%E5%99%A8"><span class="nav-number">3.3.</span> <span class="nav-text">压控振荡器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%8E%AF%E8%B7%AF%E6%BB%A4%E6%B3%A2%E5%99%A8"><span class="nav-number">3.4.</span> <span class="nav-text">环路滤波器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B9%98%E6%B3%95%E9%89%B4%E7%9B%B8%E5%99%A8%E9%94%81%E7%9B%B8%E7%8E%AF%E5%9F%BA%E6%9C%AC%E7%9B%B8%E4%BD%8D%E6%96%B9%E7%A8%8B"><span class="nav-number">3.5.</span> <span class="nav-text">乘法鉴相器锁相环基本相位方程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%94%81%E7%9B%B8%E7%8E%AF%E9%94%81%E5%AE%9A%E9%97%AE%E9%A2%98"><span class="nav-number">3.6.</span> <span class="nav-text">锁相环锁定问题</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BB%8F%E5%85%B8%E7%9A%84%E4%B8%89%E7%9B%B8%E9%94%81%E7%9B%B8%E7%8E%AF"><span class="nav-number">4.</span> <span class="nav-text">经典的三相锁相环</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%8F%E5%85%B8%E4%B8%89%E7%9B%B8%E9%94%81%E7%9B%B8%E7%8E%AF%E5%8E%9F%E7%90%86%E5%9B%BE"><span class="nav-number">4.1.</span> <span class="nav-text">经典三相锁相环原理图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%8F%E5%85%B8%E4%B8%89%E7%9B%B8%E9%94%81%E7%9B%B8%E7%8E%AF%E6%9C%89%E5%85%B3%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F"><span class="nav-number">4.2.</span> <span class="nav-text">经典三相锁相环有关数学公式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%8F%E5%85%B8%E4%B8%89%E7%9B%B8%E9%94%81%E7%9B%B8%E7%8E%AF%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90"><span class="nav-number">4.3.</span> <span class="nav-text">经典三相锁相环原理分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8D%E5%B9%B3%E8%A1%A1%E7%94%B5%E7%BD%91%E7%94%B5%E5%8E%8B%E5%AF%B9%E9%94%81%E7%9B%B8%E7%8E%AF%E7%9A%84%E5%BD%B1%E5%93%8D"><span class="nav-number">4.4.</span> <span class="nav-text">不平衡电网电压对锁相环的影响</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AF%B9%E7%A7%B0%E5%88%86%E9%87%8F%E6%B3%95"><span class="nav-number">5.</span> <span class="nav-text">对称分量法</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%8C%E5%90%8C%E6%AD%A5%E5%9D%90%E6%A0%87%E7%B3%BB%E8%A7%A3%E8%80%A6%E9%94%81%E7%9B%B8%E7%8E%AF"><span class="nav-number">6.</span> <span class="nav-text">双同步坐标系解耦锁相环</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%8C%E5%90%8C%E6%AD%A5%E5%9D%90%E6%A0%87%E7%B3%BB%E7%9A%84%E4%B8%80%E4%BA%9B%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F"><span class="nav-number">6.1.</span> <span class="nav-text">双同步坐标系的一些数学公式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E8%80%A6%E7%BD%91%E7%BB%9C"><span class="nav-number">6.2.</span> <span class="nav-text">解耦网络</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%99%9A%E6%8B%9F%E5%B9%B3%E5%9D%87%E6%97%A0%E5%8A%9F%E9%89%B4%E7%9B%B8%E5%8D%95%E7%9B%B8%E9%94%81%E7%9B%B8%E7%8E%AF"><span class="nav-number">7.</span> <span class="nav-text">虚拟平均无功鉴相单相锁相环</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A2%9E%E5%BC%BA%E5%9E%8B%E5%8D%95%E7%9B%B8%E9%94%81%E7%9B%B8%E7%8E%AFEPLL"><span class="nav-number">8.</span> <span class="nav-text">增强型单相锁相环EPLL</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E5%BB%B6%E8%BF%9F%E6%B3%95%E7%9A%84%E8%99%9A%E6%8B%9F%E4%B8%A4%E7%9B%B8%E7%9A%84%E5%8D%95%E7%9B%B8%E9%94%81%E7%9B%B8%E7%8E%AF"><span class="nav-number">9.</span> <span class="nav-text">基于延迟法的虚拟两相的单相锁相环</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E5%BE%AE%E5%88%86%E6%B3%95%E7%9A%84%E8%99%9A%E6%8B%9F%E4%B8%A4%E7%9B%B8%E7%9A%84%E5%8D%95%E7%9B%B8%E9%94%81%E7%9B%B8%E7%8E%AF"><span class="nav-number">10.</span> <span class="nav-text">基于微分法的虚拟两相的单相锁相环</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8EPark%E5%8F%8D%E5%8F%98%E6%8D%A2%E8%99%9A%E6%8B%9F%E4%B8%A4%E7%9B%B8%E7%9A%84%E5%8D%95%E7%9B%B8%E9%94%81%E7%9B%B8%E7%8E%AF"><span class="nav-number">11.</span> <span class="nav-text">基于Park反变换虚拟两相的单相锁相环</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8ESOGI%E7%9A%84%E5%8D%95%E7%9B%B8%E9%94%81%E7%9B%B8%E7%8E%AF"><span class="nav-number">12.</span> <span class="nav-text">基于SOGI的单相锁相环</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88SOGI%E8%83%BD%E7%B2%BE%E7%A1%AE%E8%B7%9F%E8%B8%AA%E4%B8%BA%E6%AD%A3%E5%BC%A6%E7%9A%84%E8%BE%93%E5%85%A5%E4%BF%A1%E5%8F%B7"><span class="nav-number">12.1.</span> <span class="nav-text">为什么SOGI能精确跟踪为正弦的输入信号?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88SOGI%E4%B8%A4%E8%BE%93%E5%87%BA%E4%BF%A1%E5%8F%B7%E4%B8%A5%E6%A0%BC%E6%AD%A3%E4%BA%A4%EF%BC%9F"><span class="nav-number">12.2.</span> <span class="nav-text">为什么SOGI两输出信号严格正交？</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%94%81%E7%9B%B8%E7%8E%AF%E7%9A%84%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87"><span class="nav-number">13.</span> <span class="nav-text">锁相环的性能指标</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8E%A8%E8%8D%90%E9%98%85%E8%AF%BB%E6%9C%89%E5%85%B3PLL%E6%96%87%E7%8C%AE"><span class="nav-number">14.</span> <span class="nav-text">推荐阅读有关PLL文献</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A4%87%E6%B3%A8"><span class="nav-number">15.</span> <span class="nav-text">备注</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="nav-number">16.</span> <span class="nav-text">参考文献</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="seanchrist" src="/images/avatar.gif"><p class="site-author-name" itemprop="name">seanchrist</p><div class="site-description" itemprop="description">阳光洒肩头 仿佛自由人</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">15</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">8</span> <span class="site-state-item-name">categories</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">17</span> <span class="site-state-item-name">tags</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/seanchristspc" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;seanchristspc" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="/seanchristspc@gmail.com" title="E-Mail → seanchristspc@gmail.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a></span></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://www.tjupt.org/" title="https:&#x2F;&#x2F;www.tjupt.org&#x2F;" rel="noopener" target="_blank">TJUPT</a></li></ul></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2018 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">seanchrist</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-chart-area"></i> </span><span title="Symbols count total">130k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="Reading time total">1:59</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a></div></div></footer></div><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script><script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script src="/js/local-search.js"></script><script>document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});</script><script>if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginModelPath:"assets/",model:{jsonPath:"/live2dw/assets/koharu.model.json"},display:{position:"right",width:150,height:300},mobile:{show:!1},react:{opacity:1},log:!1,pluginJsPath:"lib/",pluginRootPath:"live2dw/",tagMode:!1})</script></body></html>