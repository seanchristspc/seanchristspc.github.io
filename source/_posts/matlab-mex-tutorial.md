---
title: matlab mex tutorial
comment: true
mathjax: true
date: 2021-06-16 21:42:16
updated: 2022-04-23 15:25:40
description: åœ¨è‡ªå·±ä½¿ç”¨ C è¯­è¨€å†™çš„äºŒé˜¶ä½é€šæ»¤æ³¢å™¨ï¼Œéœ€è¦æŸ¥çœ‹è‡ªå·±å†™çš„ C è¯­è¨€ä»£ç æ˜¯å¦æ­£ç¡®ï¼Œæ˜¯å¦èƒ½æ­£ç¡®å®ç°æ•°å­—ä½é€šæ»¤æ³¢ï¼Œæ•…éœ€è¦éªŒè¯ä¸€ä¸‹ã€‚è¦å®ç°æŠŠ C è¯­è¨€äº§ç”Ÿçš„æ•°æ®å¯¼å…¥ matlab ä¸­ï¼Œæ–¹ä¾¿ä½¿ç”¨ matlab æ¥åˆ†ææ•°æ®ï¼Œæˆ–è€…æ–¹ä¾¿ç”»å›¾ã€‚åŒæ—¶åœ¨è®¾è®¡æ»¤æ³¢å™¨å‚æ•°ï¼Œä½¿ç”¨åˆ°äº† matlab çš„ filterDesigner å·¥å…·ã€‚å½“ç„¶ C è¯­è¨€ä¹Ÿæœ‰ç”»å›¾çš„åº“ï¼Œæˆ–è€…åœ¨ github ä¸Šèƒ½æ‰¾åˆ°ï¼Œä½†æ˜¯ä¸æƒ³å­¦ä¹ Cçš„åº“å‡½æ•°ï¼Œæƒ³ç”¨ç†Ÿæ‚‰çš„ matlab ç”»å›¾å·¥å…·ï¼
tags:
  - MATLAB
  - MEX
  - Filter

categories:
  - MATLAB

---



# ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ matlab mex

æˆ‘æ¥èŠèŠæ€ä¹ˆå’Œ **matlab mex** ç›¸é‡çš„å§ï¼å“ˆå“ˆå“ˆï¼ä¹Ÿå¯ä»¥è¯´æ˜¯æˆ‘æœ‰æ±‚äº **matlab mex**ï¼Œéœ€è¦å®ƒçš„å¸®åŠ©ï¼

*Matlab Mex brother! help me! help me!* 

è‡ªå·±åœ¨ç”¨ C è¯­è¨€å†™ä½é€šæ»¤æ³¢å™¨ï¼Œä½†æ˜¯åœ¨å®é™…çš„ç¡¬ä»¶è°ƒè¯•ç”µè·¯ä¸­ï¼Œå‘ç°æ»¤æ³¢å™¨è¾“å‡ºçš„ç»“æœ **inf** (æ— ç©·å¤§)ï¼Œåˆ°åº•æ˜¯æ€ä¹ˆä¸€å›äº‹ï¼Ÿæˆ‘åº”è¯¥å»å“ªé‡Œ debug å‘¢ï¼Ÿ


æ”¾ä¸‹ç¡¬ä»¶è°ƒè¯•ç”µè·¯ï¼Œå»å‘¨å›´æºœè¾¾æºœè¾¾ï¼Œå‡ºå»é€é€æ°”ï¼Œå‘¼å¸å‘¼å¸äººé—´çƒŸç«ã€‚ä¼‘æ¯å›æ¥åï¼Œæ€è€ƒæ€è€ƒï¼Œæ»¤æ³¢å™¨ä¸ºä»€ä¹ˆä¸æ­£å¸¸å·¥ä½œï¼Ÿ éš¾é“æˆ‘æ»¤æ³¢å™¨å‚æ•°è®¾ç½®ä¸å¯¹å—ï¼Ÿè¿˜æ˜¯ C è¯­è¨€ä»£ç å‡ºäº†é—®é¢˜ï¼Ÿè¿˜æ˜¯å…¶ä»–åŸå› ï¼Ÿä¸ºäº† debugï¼Œè¿˜æ˜¯æŠŠè¿™éƒ¨åˆ†æ»¤æ³¢å™¨ä»£ç åˆ†ç¦»å‡ºæ¥ï¼Œçœ‹çœ‹æ˜¯å¦æ­£ç¡®ï¼Ÿ 

åœ¨å¾—åˆ°è¾“å…¥çš„ä¿¡å·æ•°æ®å’Œè¾“å‡ºä¿¡å·æ•°æ®ï¼Œéœ€è¦å¯¹ä»–ä»¬è¿›è¡Œåˆ†æã€‚ç”±äºæœ‰æˆåƒä¸Šä¸‡ä¸ªæ•°æ®ç‚¹ï¼Œä¸å¯èƒ½è‡ªå·±æ‰‹è¾“å…¥åˆ° matlab æ•°ç»„é‡Œé¢ã€‚é‚£ä¹ˆç›®å‰æœ‰ä¸¤ç§æ–¹æ¡ˆï¼Œè§£å†³æ•°æ®åˆ†æé—®é¢˜ï¼Œç¬¬ä¸€ç§è¿˜æ˜¯ç”¨Cè¯­è¨€åˆ†ææ•°æ®å’Œç”»å›¾ï¼ˆ C è¯­è¨€ä»£ç åå‘åº•å±‚ï¼Œä¸é€‚åˆåˆ†ææ•°æ®ï¼Œpython å€’æ˜¯å¯ä»¥ï¼Œä½†æ˜¯æˆ‘çš„ DSP ä¸­çš„ç¨‹åºæ˜¯Cè¯­è¨€ï¼Œä¸ºäº†ä¿æŒ DSP ä¸­çš„ä»£ç å’Œæˆ‘æµ‹è¯•ä»£ç ä¸€è‡´æ€§ï¼Œpython ä¸é€‚åˆå½“å‰æ“ä½œã€‚å»githubä¸Šæ‰¾Cè¯­è¨€çš„å›¾å½¢åº“å‡½æ•°æˆ–æ•°æ®åˆ†æåŒ…ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸é”™çš„è§£å†³æ–¹æ¡ˆï¼Œä½†æˆ‘ä¸»è§‚ä¸Šä¸åƒå­¦ä¹ å…¶ä»–åº“å‡½æ•°ï¼Œå­¦ä¹ æˆæœ¬æ¯”è¾ƒå¤§ï¼‰ï¼Œç¬¬äºŒç§ä½¿ç”¨ matlab å’Œ C è¯­è¨€çš„å‡½æ•°æ¥å£ï¼Œå³ä»Šå¤©çš„ä¸»è¦å†…å®¹ matlab mexï¼Œ å®ç°Cè¯­è¨€æ•°æ®å’Œmatlabæ•°æ®ä¹‹é—´çš„æ²Ÿé€šã€‚

---

# æ“ä½œç¯å¢ƒ

- OSï¼šLinux
- matlab version: matlab 2017b
- gcc verison: 8.3.0 (5.3å®˜æ–¹æ¨è)

---

# ä½é€šæ»¤æ³¢å™¨ç¦»æ•£è®¾è®¡

ä½¿ç”¨ matlab çš„ filterDesiner å·¥å…·æ¥è®¾è®¡ä½é€šæ»¤æ³¢å™¨ï¼Œè¯¥å·¥å…·ä¸»è¦ç”¨äºæ»¤æ³¢å™¨çš„è®¾è®¡ï¼Œå¯ä»¥è®¾è®¡å¤šç§æ»¤æ³¢å™¨ã€‚

## fiterDesiner quick Overview

åœ¨matlab command çª—å£è¾“å…¥ `filterDesigner` ï¼Œå¯åŠ¨æ»¤æ³¢å™¨è®¾è®¡å·¥å…·ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸º filterDesigner å¯åŠ¨åçš„ç•Œé¢ã€‚

**å„ä¸ªåŠŸèƒ½å—åšå¦‚ä¸‹è¯´æ˜**ï¼š

1. æ˜¾ç¤ºå½“å‰çš„è®¾è®¡æ»¤æ³¢å™¨çš„ä¿¡æ¯ï¼Œå…¶ä¸­ **Order** æŒ‡çš„æ˜¯æ»¤æ³¢å™¨çš„é˜¶æ•°ã€‚
2. è®¾è®¡æ»¤æ³¢å™¨çš„çš„ç±»å‹ï¼Œæ˜¯ä½é€šæ»¤æ³¢å™¨è¿˜æ˜¯é«˜é€šæ»¤æ³¢å™¨è¿˜æ˜¯å¸¦é€šæ»¤æ³¢å™¨æˆ–æ˜¯å…¶ä»–çš„ã€‚
3. æ»¤æ³¢å™¨çš„è®¾è®¡æ–¹æ³•ï¼Œé¦–å…ˆåˆ†ä¸ºä¸¤å¤§ç±»(é’ˆå¯¹ç¦»æ•£åŒ–æ»¤æ³¢å™¨è®¾è®¡)ï¼ŒIIR å’Œ FIRï¼Œ ç„¶åå…¶ä¸­å¯ä»¥é€‰æ‹© butterworth æˆ– chebyshev I æˆ– chebyshev II æ»¤æ³¢æ–¹æ³•
4. æŒ‡å®šæ˜¯æ»¤æ³¢å™¨çš„é˜¶æ•°ï¼Œå¯ä»¥è®¾ç½®æŒ‡å®šçš„é˜¶æ•°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªåŠ¨ä¼˜åŒ–åçš„æœ€å°é˜¶æ•°ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæœ€å°é˜¶æ•°çš„æ–¹æ³•ä¼˜åŒ–çš„æ»¤æ³¢å™¨ç»“æœæ›´å¥½ï¼Œä½†æ˜¯é˜¶æ•°ä¸€èˆ¬éƒ½å¤§äº2é˜¶ä»¥ä¸Šï¼Œå¯¹äºéœ€è¦äºŒé˜¶æˆ–ä»¥ä¸‹çš„æ»¤æ³¢å™¨ï¼Œéœ€è¦å…·ä½“æŒ‡å®šé˜¶æ•°ã€‚
5. é¢‘ç‡å‚æ•°çš„è®¾è®¡ï¼Œé¦–å…ˆæ˜¯ **Unit** æŒ‡å®šå•ä½ï¼Œç„¶å **Fs** ä¸ºé‡‡æ ·é¢‘ç‡ï¼Œ è‡³äº **Fpass** **Fstop** å¯ä»¥æŸ¥çœ‹7ä¸­çš„å‚æ•°ï¼Œå¯ä»¥æ˜ç¡®çŸ¥é“ï¼Œ **Fpass** ä¸ºæˆªè‡³é¢‘ç‡ï¼Œ **Fstop** å’Œ **Astop** é…åˆï¼Œ **Astop** æŒ‡å®šå…·ä½“çš„è¡°å‡åˆ†è´ï¼Œå¯¹åº”çš„é¢‘ç‡ä¸º **Fstop**ã€‚
6. å¹…åº¦å‚æ•°è®¾ç½®ï¼Œå’Œé¢‘ç‡å‚æ•°çš„è®¾è®¡ç»“åˆä½¿ç”¨ï¼Œ **Apass** å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„é€šå¸¦è¡°å‡åˆ†è´å’Œæˆªè‡³é¢‘ç‡ **Fpass** ç›¸å¯¹åº”ï¼Œä¸€èˆ¬æ¥è¯´ **Apass=3dB**ï¼Œ **Astop** å’Œ **Fstop** å¯¹åº”ï¼Œä¸€èˆ¬æ˜¯æ¯20dBå¯¹åº”è¡°å‡å¹…åº¦$\frac{1}{10}$. åˆ†è´å…¬å¼å¦‚ä¸‹: $$ dB = -20 \lg A $$ A ä¸ºå¢ç›Šå€æ•°ã€‚

7. å‚æ•°è®¾è®¡çš„å‚è€ƒå›¾

![filterDesigner overview](matlab-mex-tutorial/filterDesignerOverview.png)
é’ˆå¯¹**5ï¼Œ6**çš„è®¾ç½®å¤šçœ‹çœ‹ **7**å°±æ˜ç™½äº†ã€‚


# filterDesigner Example

è®¾è®¡äºŒé˜¶ä½é€šæ»¤æ³¢å™¨ï¼Œé‡‡ç”¨ IIR butterworth æ»¤æ³¢å™¨ï¼Œæˆªè‡³é¢‘ç‡ $fc=600Hz$ï¼Œé‡‡æ ·é¢‘ç‡$fs=10000Hz$ï¼Œå…·ä½“æ“ä½œï¼Œè¯·çœ‹å¦‚ä¸‹åŠ¨å›¾ã€‚

![filterDesigner Example](matlab-mex-tutorial/filterDesignerUseExample.gif)

è®¾è®¡åçš„å…·ä½“å‚æ•°å¦‚ä¸‹ï¼š
```
--------------------------                
Section #1                                
--------------------------                
Numerator:                                
1                                         
2                                         
1                                         
Denominator:                              
 1                                        
-1.475480443592646073724949928873684257269
 0.586919508061190309256005548377288505435
Gain:                                     
0.027859766117136031127188289246987551451 
--------------------------                
Output Gain:                              
1        

```

è¯¥å‚æ•°æ˜¯zå˜æ¢ä¸‹çš„å¸¸æ•°ï¼Œå‚æ•°å¯¹åº”çš„å…¬å¼å¦‚ä¸‹ï¼š

$$H(z)=0.027856\frac{1+2z^{-1}+z^{-2}}{1-1.17548z^{-1}+0.58692z^{-2}}$$

è½¬æ¢æˆç¦»æ•£è¡¨è¾¾å¼ï¼š

$$Y(n)=0.027856[X(n)+2X(n-1)+X(n-2)]+1.47548Y(n-1)-0.58693Y(n-2)$$

è¾“å…¥ä¸ºXï¼Œè¾“å‡ºä¸ºYã€‚é€šè¿‡ä¸Šè¿°ç¦»æ•£è¡¨è¾¾å¼ä¹¦å†™Cè¯­è¨€æ•°å­—æ»¤æ³¢å™¨ã€‚

# ä½é€šæ»¤æ³¢å™¨Cè¯­è¨€ä»£ç 

## äºŒé˜¶æ•°å­—æ»¤æ³¢å™¨å®å®šä¹‰

```C

// IIR Butterworth second order sections
// fs=10kHz,fc=600Hz
#define LPF2_k1      0.02786		//gain
#define LPF2_a11     -1.47548		//denominator
#define LPF2_a12     0.58692
#define LPF2_b10     1*LPF2_k1		//numerator
#define LPF2_b11     2*LPF2_k1
#define LPF2_b12     1*LPF2_k1

#define PI 3.14159

struct filterValues {
	float x[3];	/* input values: x(n):x[0], x(n-1):x[1], x(n-2)=x[2]  */
	float y[3];	/* output values: y(n):y[0], y(n-1):y[1], y(n-2)=y[2]  */
};

```

## äºŒé˜¶æ»¤æ³¢å‡½æ•°

```C
/*! \brief low pass filter
 *
 * second order low pass filter:
 * 	fs=10khz(sample frequency), fc=600hz(cutoff frequency)
 * 	z transfer function:
 * 			   		1+2z^(-1)+z^(-2)
 * 		h(z)=0.02786  ---------------------------------
 *				1-1.47548z^(-1)+0.58692z^(-2)
 *
 * \param inputvalue: current input value
 * \param values: pointer to filtervalues
 *
 * \return no return
 */
void lowpassfilter(float inputvalue, struct filtervalues *values)
{
	values->x[0]=inputvalue;
	values->y[0] =LPF2_b10*(values->x[0])+LPF2_b11*(values->x[1])+LPF2_b12*(values->x[2])-LPF2_a11*(values->y[1])-LPF2_a12*(values->y[2]);

	values->x[2]=values->x[1];                                                  //xå­˜å‚¨å€¼æ›´æ–°
    	values->x[1]=values->x[0];

    	values->y[2]=values->y[1];                                                //yå­˜å‚¨å€¼æ›´æ–°
    	values->y[1]=values->y[0];                                                //y[0]ä¸ºæœ€ç»ˆæ»¤æ³¢è¾“å‡º
}


```

## éœ€è¦å¯¼å…¥çš„å¤´æ–‡ä»¶

```C
#include <stdio.h>
#include <math.h>
#include "mex.h"
```

**math.h** æ–‡ä»¶ä¸»è¦ç”¨äºè®¡ç®— sin çš„å€¼ï¼Œç”¨äºäº§ç”Ÿæ­£å¼¦ä¿¡å·ã€‚ **mex.h** ä¸»è¦ç”¨äº C è¯­è¨€å’Œ matlab æ•°æ®äº¤äº’ã€‚

---

# matlab mex

## matlab mex install
matlab mex çš„å®‰è£…æ¯”è¾ƒç®€å•ï¼Œå‚è€ƒ[MinGW-w64 C/C++ Compiler](https://ww2.mathworks.cn/matlabcentral/fileexchange/52848-matlab-support-for-mingw-w64-c-c-compiler?s_tid=mwa_osa_a)ï¼Œç™»å½• matlab å¸å·ï¼Œä¸‹è½½å®‰è£…æ–‡ä»¶å³å¯ã€‚ç”¨äº Window å¹³å°ï¼ŒGCC ç¼–è¯‘å™¨çš„å®‰è£…ï¼ŒåŸºæœ¬ä¸Šæ˜¯ç‚¹ç‚¹ç‚¹å°±è¡Œäº†ã€‚ä½†æ˜¯éœ€è¦å¤–ç½‘ï¼Œç½‘ç»œä¸å¥½ï¼Œåªæœ‰æ‰‹åŠ¨å®‰è£… GCC ç¼–è¯‘å™¨ã€‚å®‰è£… matlab ç‰ˆæœ¬ç›¸å¯¹åº”çš„ GCC ç‰ˆæœ¬ï¼Œå¯¹äº R2017b and R2018a GCC 5.3ã€‚æœ€å¥½å®‰è£…å’Œ matlab ç‰ˆæœ¬ä¸€è‡´çš„ç‰ˆæœ¬ã€‚ å¯¹äºlinuxç³»ç»Ÿï¼Œå°±æ— éœ€ä½¿ç”¨è¯¥æ–¹æ³•å®‰è£… GCC ç¼–è¯‘å™¨ã€‚linuxä¸€èˆ¬æƒ…å†µä¸‹æ˜¯è‡ªå¸¦ gcc ç¼–è¯‘å™¨ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå®‰è£…ä¹Ÿæ¯” Windows æ–¹ä¾¿ã€‚å½“å‰æˆ‘çš„ gcc ç‰ˆæœ¬å’Œå®˜æ–¹æ¨èçš„ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œæ¯” matlab æ¨èçš„ GCC ç‰ˆæœ¬é«˜ï¼Œåœ¨ä½¿ç”¨ mex ä¼šæœ‰è­¦å‘Šï¼Œæç¤ºç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œå¯ä»¥å¿½ç•¥ã€‚è‡³å°‘åœ¨æˆ‘å½“å‰ä½¿ç”¨ä¸­æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚

![mex complie C ](matlab-mex-tutorial/mexFirstUse.png)

## matlab mexFunction
C è¯­è¨€çš„æ»¤æ³¢å‡½æ•°å’Œ matlab mex å·²ç»é…ç½®å®Œæˆã€‚å‰©ä¸‹çš„ä¾¿æ˜¯å®Œæˆ C è¯­è¨€å’Œ matlab ä¹‹é—´çš„ç¼–ç¨‹æ¥å£ã€‚é¡ºä¾¿æä¸€ä¸‹ï¼Œmatlab çš„ mex æ”¯æŒ C è¯­è¨€å’Œ Fortran è¯­è¨€ã€‚åœ¨ä½é€šæ»¤æ³¢æ“ä½œä½¿ç”¨çš„æ˜¯ C è¯­è¨€ã€‚é€šè¿‡ mex ç¼–è¯‘ C è¯­è¨€çš„æºæ–‡ä»¶ï¼Œå¯ä»¥å¾—åˆ° matlab å¯è¿è¡Œçš„ mex æ–‡ä»¶ã€‚ä»è€Œå®ç° C å’Œ matlab ä¹‹é—´çš„æ•°æ®äº¤äº’æ“ä½œï¼Œéœ€è¦åœ¨ C æºä»£ç æ–‡ä»¶ä¸­æ·»åŠ  **mexFunction** å‡½æ•°ï¼Œå¯ä»¥ç†è§£åœ¨Cè¯­è¨€ä¸­çš„ä¸»å‡½æ•°ï¼Œç”¨äºè°ƒç”¨è‡ªå·±å†™çš„å…¶ä»– C å‡½æ•°ï¼Œå®ç°å…·ä½“çš„åŠŸèƒ½ã€‚

```C
#include "mex.h"				//å¼•å…¥mexå¤´æ–‡ä»¶
void mexFunction(int nlhs, mxArray *plhs[], 	//è¾“å‡ºç»“æœ
int nrhs, const mxArray *prhs[])		//è¾“å…¥å‚æ•°
```

**mexFunctionå‚æ•°**: 

1. **nlhs**: Number of expected output mxArrays  è¾“å‡ºç»“æœçš„æ•°é‡
2. **plhs**: Array of pointers to the expected output mxArrays  è¾“å‡ºç»“æœçš„æŒ‡é’ˆæ•°ç»„
3. **nrhs**: Number of input mxArrays	è¾“å…¥å‚æ•°çš„æ•°é‡
4. **prhs**: Array of pointers to the input mxArrays. Do not modify any prhs values in your MEX file. 
Changing the data in these read-only mxArrays can produce undesired side effects. è¾“å…¥å‚æ•°çš„æŒ‡é’ˆæ•°ç»„ã€‚

ä¸€å¥è¯æ€»ç»“ä¸€ä¸‹ mexFunctionï¼Œè¾“å‡ºå‚æ•°çš„å’Œè¿”å›ç»“æœçš„æ•°é‡å’ŒæŒ‡é’ˆæ•°ç»„(å­˜å‚¨è¾“å…¥å’Œè¾“å‡ºçš„å…·ä½“ç»“æœ)ã€‚

## mexFunctionä¸­å¸¸ç”¨å‡½æ•°
å¯¹ mexFunction ä¸­éœ€è¦ä½¿ç”¨çš„ä¸€äº›å¸¸ç”¨å‡½æ•°åšç®€è¦è¯´æ˜ã€‚

`mwPointer mxCreateDoubleMatrix(m, n, ComplexFlag)`
è¯¥å‡½æ•°ç”¨äºåˆ›å»ºä¸€ä¸ªçŸ©é˜µï¼Œm ä¸ºè¡Œï¼Œn ä¸ºåˆ—ï¼Œ `ComplexFlag` ç”¨äºæŒ‡å®šçŸ©é˜µä¸­å…ƒç´ çš„æ•°æ®ç±»å‹ï¼Œå¯¹äºå®æ•°ï¼š`mxREAL`ï¼Œè¿”å›çš„æ˜¯è¯¥çŸ©é˜µçš„æŒ‡é’ˆ(åœ°å€)ã€‚ä¸€èˆ¬æ˜¯æŠŠè¿”å›å€¼èµ‹ç»™æ•°ç»„ `plhs[]` ä¸­çš„ä¸€ä¸ªæŒ‡é’ˆã€‚å®é™…ä½¿ç”¨è¯¥å‡½æ•°ï¼Œä¸»è¦ç”¨äºåœ¨å†…å­˜ä¸­ä¸ºçŸ©é˜µåˆ†é…ç©ºé—´ã€‚

`double *mxGetPr(const mxArray *pm)` è¯¥å‡½æ•°ç”¨äºè·å–æ•°ç»„çš„é¦–åœ°å€ï¼Œå³ç¬¬ä¸€ä¸ªå…ƒç´ çš„åœ°å€æŒ‡é’ˆã€‚

`int mexPrintf(const char *message, ...)` å’Œ C è¯­è¨€ä¸­çš„ `printf()` å‡½æ•°çš„ç”¨æ³•ä¸€æ ·ã€‚


## mexFunction å…·ä½“Cä»£ç 
mexFunction äºŒé˜¶ä½é€šæ»¤æ³¢å™¨çš„ C æºä»£ç ã€‚åœ¨æ­£å¼¦åŸºæ³¢åˆ†é‡çš„åŸºç¡€ä¸Šï¼Œæ·»åŠ äº†é«˜é¢‘ç‡çš„æ¯›åˆº(ä¹Ÿæ˜¯æ­£å¼¦åˆ†é‡ï¼Œåªæ˜¯é¢‘ç‡æ¯”åŸºæ³¢é«˜å¾ˆå¤š)ã€‚å¦‚ä¸‹ä¸ºäºŒé˜¶ä½é€šæ»¤æ³¢å’Œ matlab æ•°æ®äº¤æ¢çš„å…·ä½“ä»£ç ï¼š


```C
/*
 * nlhs è¾“å‡ºç»“æœ æ•°é‡
 * plhs è¾“å‡ºç»“æœ æŒ‡é’ˆ
 *
 * nrhs è¾“å…¥å‚æ•° æ•°é‡
 * prhs è¾“å…¥å‚æ•° æŒ‡é’ˆ
 *
 */

void mexFunction(int nlhs, mxArray *plhs[],
        int nrhs, const mxArray *prhs[])
{
	int N=400;
	int n=10;	//æ˜¾ç¤ºå‘¨æœŸæ•°
	int f=3000;	//ç›¸å¯¹é¢‘ç‡
	int i,m;
	float delta=2*PI/N/f;
	float point=0;
    	double *input,*result;
	struct filterValues fvalues={{0,0,0},{0,0,0}};

	plhs[0]= mxCreateDoubleMatrix(1, N*n*f, mxREAL);
	plhs[1] = mxCreateDoubleMatrix(1, n*N, mxREAL);

	input  = mxGetPr(plhs[0]);
    	result = mxGetPr(plhs[1]);
	m=0;
	for (i = 0; i < N*n*f; ++i) {
		input[i]=sin(point)+0.2*sin(point*f);
		point+=delta;
		if (i%(f)==0) {
		LowPassFilter(input[i], &fvalues);
       		result[m]=fvalues.y[0];
	       	m++;	//remember increment m!
		}
		//mexPrintf("y[%d]=%f\n",i,fvalues.y[0]);
	}

}

```

## compile C source file by mex

åœ¨ matlab å‘½ä»¤è¡Œä¸­è¾“å‡ºå¦‚ä¸‹å†…å®¹ï¼Œå…¶ä¸­ `LowPassFilter.c` ä¸º C è¯­è¨€æºä»£ç æ–‡ä»¶ã€‚
```C
mex LowPassFilter.c
```

ç¼–è¯‘æˆåŠŸåï¼Œå¯åœ¨ matlab ä¸­ç›´æ¥æ‰§è¡Œ LowPassFilter å‘½ä»¤ï¼Œç”±äºä¸Šè¿° mexFunction æœ‰ä¸¤ä¸ªè¿”å›å€¼ï¼Œæ•…åœ¨matlab Commanderçª—å£è¾“å…¥ï¼š

```
[a,b]=LowPassFilter;

% ä½œå›¾
plot(linspace(0,10*pi,12000000),a)
hold on
plot(linspace(0,10*pi,4000),b)
```


## lowpass filer result

æ»¤æ³¢ç»“æœï¼Œè¯·è§ä¸‹å›¾ï¼Œå¯ä»¥å‘ç°æ»¤æ³¢è¯¥æ»¤æ³¢å‚æ•°èƒ½è¾ƒå¥½çš„è¿›è¡Œæ»¤æ³¢ã€‚è‡³äºæœ€åˆä¸ºä»€ä¹ˆå®é™…çš„ç¡¬ä»¶ç”µè·¯æ— æ³•å®Œæˆæ»¤æ³¢ï¼Œè¿˜éœ€è¿›ä¸€æ­¥æŸ¥æ‰¾åŸå› ï¼Œè‡³å°‘èƒ½æ’é™¤å‚æ•°å’Œæ»¤æ³¢å™¨Cè¯­è¨€æºä»£ç æ²¡æœ‰é—®é¢˜ã€‚

![low pass filter result](matlab-mex-tutorial/lowpassResult.svg)

---

# æ»¤æ³¢å™¨è¾“å‡ºinfé—®é¢˜

åœ¨å®é™…çš„ DSP ç¡¬ä»¶ç”µè·¯ä¸­ï¼Œæ•°å­—æ»¤æ³¢å™¨è¾“å‡ºæ— ç©·å¤§ **inf** é—®é¢˜ï¼Œå³ `filtervalues.y[0]=inf`ï¼Œéœ€è¦è§£å†³è¯¥é—®é¢˜ï¼Œæ­£å¦‚å‰é¢æ’é™¤æ»¤æ³¢å™¨ C è¯­è¨€ä»£ç çš„é—®é¢˜ï¼Œå›æƒ³ä»¥ä¸‹ã€‚ç”¨å®é™…çš„ç¤ºæ³¢å™¨æµ‹é‡ä¸€ä¸‹æ»¤æ³¢å™¨æœªæ»¤æ³¢çš„æ³¢å½¢ï¼Œå‘ç°æ¯ä¸ªå‘¨æœŸæœ‰å¤šä¸ªçªå˜ç‚¹ï¼Œé—®é¢˜åº”è¯¥å‡ºåœ¨è¾“å…¥æ³¢å½¢å…·æœ‰çªå˜çš„åœ°æ–¹ï¼ŒæŸ¥çœ‹è¾“å…¥å€¼çš„ **inf**ï¼Œè‡ªç„¶æ»¤æ³¢å¾—åˆ°çš„ç»“æœä¸ºæ— ç©·å¤§ã€‚æ•…åœ¨æ»¤æ³¢çš„å‰ï¼Œ**è¾“å…¥ä¿¡å·å¢åŠ ä¸€ä¸ªé™å¹…ç¯èŠ‚**ã€‚å³åœ¨è°ƒç”¨ `LowPassFilter(float inputvalue, struct filterDesigner *values)` ä¹‹å‰ï¼Œæ·»åŠ ä¸€å¥é™å¹…ä»£ç ã€‚é™å¹…ä»£ç æ·»åŠ åï¼Œç¡¬ä»¶æ»¤æ³¢æ³¢å½¢å®Œå¥½äº†ã€‚åœ¨å®é™…ç¡¬ä»¶åº”ç”¨ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªé™å¹…ç¯èŠ‚ï¼Œå®Œç¾è§£å†³é—®é¢˜ã€‚å®é™…çš„è½¯ä»¶ä»¿çœŸæ¨¡æ‹Ÿä¸­ï¼Œè¾“å…¥ä¿¡å·æ¯”è¾ƒç†æƒ³ï¼Œä¸å­˜åœ¨çªå˜çš„æƒ…å†µï¼Œæ•…å¯ä»¥ä¸åŠ é™å¹…ç¯èŠ‚ã€‚

**é™å¹…ï¼é™å¹…ï¼é™å¹…ï¼**

```C
for (i = 0; i < N*n*f; ++i) {
	input[i]=sin(point)+0.2*sin(point*f);
	point+=delta;
	/************æ·»åŠ çš„é™å¹…ä»£ç  start*********************/
	//limit input values 
	if (input[i]>10) {
		input[i]=10;
	} else if (input[i]<-10) {
		input[i]=-10;
	}
	/*************æ·»åŠ çš„é™å¹…ä»£ç  end********************/
	if (i%(f)==0) {
	LowPassFilter(input[i], &fvalues);
	result[m]=fvalues.y[0];
	m++;	//remember increment m!
	}
	//mexPrintf("y[%d]=%f\n",i,fvalues.y[0]);
}

```

# Conclusion

æœ€ç»ˆï¼Œç»ˆäºå®ç° C ä»£ç å’Œ matlab ä¹‹é—´çš„äº’é€šï¼Œå¹¶ä¸”éªŒè¯è‡ªå·±çš„æ•°å­—ä½é€šæ»¤æ³¢å™¨å‚æ•°å’Œ C è¯­è¨€ä»£ç éƒ½æ²¡é—®é¢˜ã€‚åšä¸€å¤©çš„ç¡¬ä»¶è°ƒè¯•ï¼Œå‘ç°é—®é¢˜å‡ºåœ¨æœªåŠ é™å¹…ç¯èŠ‚ã€‚å› ä¸ºå®é™…çš„ä¿¡å·å­˜åœ¨å„ç§
ä¸ç¡®å®šæ€§ï¼Œæ·»åŠ é™å¹…ç¯èŠ‚ï¼Œå¯ä»¥é˜²æ­¢çªå˜ã€‚

![å®éªŒä½é€šæ»¤æ³¢æ³¢å½¢](matlab-mex-tutorial/experimentFilterWave.BMP)
è¯·çœ‹ä¸Šå›¾çš„å®éªŒæ³¢å½¢ï¼Œæ£•è‰²æ³¢å½¢æ˜¯å¸¦æœ‰é«˜é¢‘ä¿¡å·å™ªå£°çš„æ­£å¼¦æ³¢ï¼Œç´«è‰²æ³¢å½¢æ˜¯ç»è¿‡æ•°å­—æ»¤æ³¢åçš„çš„æ³¢å½¢ã€‚ååˆ†èµå¿ƒæ‚¦ç›®ï¼Œç»ˆäºå®ç°ç¡¬ä»¶å®éªŒä¸‹çš„æ•°å­—æ»¤æ³¢ã€‚


# Reference

[Matlab å¸®åŠ©æ–‡æ¡£](https://ww2.mathworks.cn/help/)




# å¤‡æ³¨

I would greatly appreciate hearing about any error in this article, even minor ones.
I welcome your suggestions for improvements, even tiny one. Please email to me! ğŸ˜

 
